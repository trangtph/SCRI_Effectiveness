"use strict";(self.webpackChunkinvenio_assets=self.webpackChunkinvenio_assets||[]).push([[1246],{21075:(e,t,n)=>{var a=n(80296),r=n(10467),i=n(23029),o=n(92901),l=n(56822),c=n(53954),s=n(85501),u=n(64467),m=n(54756),d=n.n(m),f=n(96540),p=n(1489),h=n(3487),v=n(76217),y=n(87395),b=n(5556),E=n.n(b),g=n(81057);function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(A=function(){return!!e})()}var C=function(e){function t(e){var n,a,o,s;return(0,i.A)(this,t),a=this,o=t,s=[e],o=(0,c.A)(o),n=(0,l.A)(a,A()?Reflect.construct(o,s||[],(0,c.A)(a).constructor):o.apply(a,s)),(0,u.A)(n,"fetchRequests",(0,r.A)(d().mark(function e(){var t,a,r,i,o,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.record,e.prev=1,a=(0,g.withCancel)(g.http.get("".concat(t.links.requests,"?q=type:legacy-record-upgrade&is_open=true"))),e.next=2,a.promise;case 2:r=e.sent,(i=r.data.hits).total>0&&n.setState({legacyRequestId:i.hits[0].id}),e.next=4;break;case 3:e.prev=3,l=e.catch(1),o=l.message,l.response&&(o=l.response.data.message),console.error(l),n.setState({fetchRequestsError:o});case 4:case"end":return e.stop()}},e,null,[[1,3]])}))),n.state={legacyRequestId:"",fetchRequestsError:void 0},n}return(0,s.A)(t,e),(0,o.A)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.record,n=e.currentUserId;t.parent.access.owned_by.user===n&&this.fetchRequests()}},{key:"render",value:function(){var e=this.props.isPreviewSubmissionRequest,t=this.state,n=t.legacyRequestId,a=t.fetchRequestsError;return f.createElement(f.Fragment,null,n&&!e&&f.createElement(p.A.Column,{className:"pt-0"},f.createElement(h.A,{fluid:!0,color:"white",size:"medium",onClick:function(){return window.location="/me/requests/".concat(n)},icon:!0,labelPosition:"left"},f.createElement(v.A,{name:"settings"}),"Upgrade legacy record")),a&&f.createElement(p.A.Row,{className:"record-management"},f.createElement(p.A.Column,null,f.createElement(y.A,{negative:!0},a))))}}])}(f.Component);C.propTypes={isPreviewSubmissionRequest:E().bool.isRequired,record:E().object.isRequired,currentUserId:E().string.isRequired};var w=n(58156),R=n.n(w),k=n(37114);function F(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(F=function(){return!!e})()}var q=function(e){function t(){return(0,i.A)(this,t),e=this,n=t,a=arguments,n=(0,c.A)(n),(0,l.A)(e,F()?Reflect.construct(n,a||[],(0,c.A)(e).constructor):n.apply(e,a));var e,n,a}return(0,s.A)(t,e),(0,o.A)(t,[{key:"render",value:function(){var e=this.props,t=e.draft,n=e.record,a=e.isDraftRecord,r=e.filesLocked,i=e.permissions;return"external"!==R()(t,"pids.doi.provider","")&&a?f.createElement(p.A.Row,{className:"file-upload-note pt-5"},f.createElement(p.A.Column,{width:16},f.createElement(y.A,{visible:!0,warning:!0},f.createElement("p",null,f.createElement(v.A,{name:"warning sign"}),"File addition, removal or modification are not allowed after you have published your upload.")))):r&&f.createElement(p.A.Row,{className:"file-upload-note pt-5"},f.createElement(p.A.Column,{width:16},f.createElement(y.A,{info:!0},f.createElement(k.z4,{record:n,onError:function(){},className:"right-floated",disabled:!i.can_new_version}),f.createElement("p",{className:"mt-5 display-inline-block"},f.createElement(v.A,{name:"info circle",size:"large"}),"You must create a new version to add, modify or delete files."))))}}])}(f.Component);q.propTypes={draft:E().object.isRequired,record:E().object.isRequired,isDraftRecord:E().bool,filesLocked:E().bool,permissions:E().object.isRequired},q.defaultProps={isDraftRecord:!0,filesLocked:!0};var S=n(92301),M=n(17684),j=n(62193),P=n.n(j),x=n(80501),N=n(27041),_=n(36713),I=n(2685),U=n(4252),V=n(64483);function D(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(D=function(){return!!e})()}var L=function(e){function t(){var e,n,a,o;(0,i.A)(this,t);for(var s=arguments.length,m=new Array(s),f=0;f<s;f++)m[f]=arguments[f];return n=this,a=t,o=[].concat(m),a=(0,c.A)(a),e=(0,l.A)(n,D()?Reflect.construct(a,o||[],(0,c.A)(n).constructor):a.apply(n,o)),(0,u.A)(e,"state",{error:"",hasCommunity:!1,communities:[]}),(0,u.A)(e,"setGlobalError",function(t){e.setState({error:t})}),(0,u.A)(e,"onSubmit",function(){var t=(0,r.A)(d().mark(function t(n,a){var r,i,o,l,c,s,u,m,f,p,h,v;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.setSubmitting,i=a.setFieldError,r(!0),o=new U.AM,l=e.state.hasCommunity,c=e.props.community,s={},u="",l?s={community_id:n.metadata.community,payload:{project_id:n.metadata.project_id}}:(u=n.metadata.slug,n.metadata.project_id,s={community:{title:n.metadata.title,slug:u},payload:{project_id:n.metadata.project_id}}),e.cancellableCreate=(0,g.withCancel)(o.createSubcommunity(c.id,s)),t.prev=1,t.next=2,e.cancellableCreate.promise;case 2:m=t.sent,r(!1),f=m.data.id,window.location.href="/communities/".concat(c.slug,"/requests/").concat(f),t.next=5;break;case 3:if(t.prev=3,"UNMOUNTED"!==(v=t.catch(1))){t.next=4;break}return t.abrupt("return");case 4:p=(0,V.U9)(v),h=p.errors,p.message&&e.setGlobalError("The form contains errors or missing fields. Please verify before submitting."),h&&h.map(function(e){var t=e.field,n=e.messages;t.startsWith("metadata")||(t="metadata.".concat(t.split(".").pop())),i(t,n[0])});case 5:case"end":return t.stop()}},t,null,[[1,3]])}));return function(e,n){return t.apply(this,arguments)}}()),e}return(0,s.A)(t,e),(0,o.A)(t,[{key:"componentDidMount",value:function(){var e=this;(0,g.withCancel)(g.http.get("/api/user/communities?sort=newest").then(function(e){return e.data}).then(function(t){var n;e.setState({communities:null===t||void 0===t||null===(n=t.hits)||void 0===n?void 0:n.hits.filter(function(e){var t;return!(null!==e&&void 0!==e&&null!==(t=e.parent)&&void 0!==t&&t.id)}).filter(function(e){var t;return!0===!(null!==e&&void 0!==e&&null!==(t=e.children)&&void 0!==t&&t.allow)}).map(function(e){return{text:e.metadata.title,value:e.id,key:e.id}})})}).catch(function(e){console.error(e)}))}},{key:"componentWillUnmount",value:function(){this.cancellableCreate&&this.cancellableCreate.cancel()}},{key:"render",value:function(){var e=this,t=this.props,n=t.formConfig,a=t.canCreateRestricted,r=t.IdentifierField,i=this.state,o=i.hasCommunity,l=i.communities,c=i.error;return f.createElement(M.Formik,{initialValues:{access:{visibility:"public"},metadata:{slug:"",title:"",project_id:""}},onSubmit:this.onSubmit},function(t){var i=t.values,s=t.isSubmitting,u=t.handleSubmit;return f.createElement(x.A,{onSubmit:u,className:"communities-creation"},f.createElement(y.A,{hidden:""===c,negative:!0,className:"flashed"},f.createElement(p.A,{container:!0,centered:!0},f.createElement(p.A.Column,{mobile:16,tablet:12,computer:8,textAlign:"left"},f.createElement("strong",null,c)))),f.createElement(p.A,{container:!0,centered:!0},f.createElement(p.A.Row,null,f.createElement(p.A.Column,{mobile:16,tablet:12,computer:8,textAlign:"center"},f.createElement(N.A,{as:"h1",className:"rel-mt-2"},S.M.t("Setup your new EU project community")),f.createElement(_.A,null))),f.createElement(p.A.Row,{textAlign:"left"},f.createElement(p.A.Column,{mobile:16,tablet:12,computer:8},f.createElement(I.A,{className:"visible message info"},f.createElement(N.A,{as:"h5",className:"rel-mb-1"},S.M.t("Only for EU-funded projects.")),S.M.t("To setup a new EU project community, you must be affiliated with an EU-funded project (e.g. Horizon 2020, Horizon Europe, Euratom)."),f.createElement(N.A,{as:"h5",className:"rel-mb-1 rel-mt-2"},S.M.t("Institutional email required.")),S.M.t("In order for us to verify the request, your Zenodo account must be using an institutional email address, so that we can verify your institutional affiliation. You can change your email address in "),f.createElement("a",{href:"/account/settings/profile"},S.M.t("your profile settings ")),S.M.t("if that is not the case.")),f.createElement("div",{className:"field"},f.createElement(x.A.Field,null,S.M.t("Do you already have an existing community?")),f.createElement(x.A.Group,null,f.createElement(g.RadioField,{label:S.M.t("Yes"),checked:!0===o,value:S.M.t("Yes"),onChange:function(){e.setState({hasCommunity:!0})},fieldPath:"metadata.hasCommunity",disabled:P()(l)}),f.createElement(g.RadioField,{label:S.M.t("No"),checked:!1===o,value:S.M.t("No"),onChange:function(){e.setState({hasCommunity:!1})},fieldPath:"metadata.hasCommunity"}))),f.createElement(g.RemoteSelectField,{fieldPath:"metadata.project_id",id:"metadata.project_id",searchQueryParamName:"q",placeholder:S.M.t("Search for a project by name"),suggestionAPIUrl:"/api/awards",suggestionAPIHeaders:{Accept:"application/vnd.inveniordm.v1+json"},suggestionAPIQueryParams:{funders:"00k4n6c32"},serializeSuggestions:function(e){return e.map(function(e){return{text:"".concat(e.title_l10n," ").concat(e.acronym?" - (".concat(e.acronym,")"):""," - ").concat(e.number),content:f.createElement(N.A,{content:"".concat(e.title_l10n).concat(e.acronym?" - (".concat(e.acronym,")"):""),subheader:e.number}),value:e.id,key:e.id,acronym:e.acronym,title:e.title_l10n}})},onValueChange:function(e){var t=e.data,n=e.formikProps,a=t.options.find(function(e){return e.value===t.value});a?(n.form.setFieldValue(n.fieldPath,a.key),n.form.setFieldValue("metadata.title",a.title),a.acronym&&n.form.setFieldValue("metadata.slug",a.acronym.toLowerCase())):(n.form.setFieldValue("metadata.project_id",""),n.form.setFieldValue("metadata.title",""),n.form.setFieldValue("metadata.slug",""))},noQueryMessage:S.M.t("Search for project..."),clearable:!0,allowAdditions:!1,multiple:!1,label:f.createElement(g.FieldLabel,{htmlFor:"metadata.project_id",icon:"group",label:S.M.t("Project")}),required:!0}),o&&f.createElement(g.SelectField,{label:f.createElement(g.FieldLabel,{icon:"user",label:S.M.t("Community"),id:"community-label",class:"block"}),fieldPath:"metadata.community",options:l,defaultValue:"Loading...",required:!0,placeholder:"Select your community"}),!o&&f.createElement(f.Fragment,null,f.createElement(g.TextField,{required:!0,id:"metadata.title",fluid:!0,fieldPath:"metadata.title",onKeyDown:function(e){"Enter"===e.key&&e.preventDefault()},label:f.createElement(g.FieldLabel,{htmlFor:"metadata.title",icon:"book",label:S.M.t("Community name")})}),f.createElement(r,{formConfig:n})),a&&f.createElement(f.Fragment,null,f.createElement(N.A,{as:"h3"},S.M.t("Community visibility")),n.access.visibility.map(function(e){return f.createElement(f.Fragment,{key:e.value},f.createElement(g.RadioField,{key:e.value,fieldPath:"access.visibility",label:e.text,labelIcon:e.icon,checked:R()(i,"access.visibility")===e.value,value:e.value,onChange:function(t){t.event,t.data;t.formikProps.form.setFieldValue("access.visibility",e.value)}}),f.createElement("label",{className:"helptext"},e.helpText))})))),f.createElement(p.A.Row,null,f.createElement(p.A.Column,{textAlign:"center"},f.createElement(h.A,{positive:!0,icon:!0,labelPosition:"left",loading:s,disabled:s,type:"button",onClick:function(e){return u(e)}},f.createElement(v.A,{name:"plus"}),o?S.M.t("Create request"):S.M.t("Create community"))))))})}}])}(f.Component);L.propTypes={formConfig:E().object.isRequired,canCreateRestricted:E().bool.isRequired,community:E().string.isRequired,IdentifierField:E().func};for(var O={"InvenioAppRdm.RecordLandingPage.RecordManagement.container":C,"ReactInvenioDeposit.FileUploader.NewVersionButton.container":q,"ReactInvenioForms.AffiliationsSuggestions.content":function(e){var t=e.creatibutor,n=e.isOrganization,a=e.makeSubheader,r=e.makeIdEntry,i=t.name,o=t.acronym,l=t.identifiers,c=void 0===l?[]:l,s=t.id,u=a(t,n),m=o?"".concat(i," (").concat(o,")"):i,d=[],h=[];return c.forEach(function(e){var t=e.scheme,n=e.identifier;if("ror"===t)d.push(f.createElement("span",{key:n},"Source: ",t.toUpperCase()," ",f.createElement("span",null,"(Preferred)")));else if("edmo"===t)d.push(f.createElement("span",{key:n},"Source: ",t.toUpperCase()));else{var a=r(e);a&&h.push(a)}}),f.createElement(p.A,{key:s},f.createElement(p.A.Row,{columns:2,verticalAlign:"middle"},f.createElement(p.A.Column,{width:12},f.createElement(N.A,null,m," ",h.length>0&&f.createElement(f.Fragment,null,"(",h,")"),u&&f.createElement(N.A.Subheader,null,u))),f.createElement(p.A.Column,{width:4,textAlign:"right"},d.length>0&&f.createElement(N.A,{as:"h6",color:"grey",style:{margin:0}},d))))},"InvenioCommunities.CommunityCreateForm.layout":L},T=n(53196),z=0,B=Object.entries(O);z<B.length;z++){var Y=(0,a.A)(B[z],2),G=Y[0],H=Y[1];T.overrideStore.add(G,H)}}},e=>{e.O(0,[3378,1057,7655,5092,8871,278,5941,9736,4683,4848,9025,2301,4252,8585,5002,7114],()=>{return t=21075,e(e.s=t);var t});e.O()}]);
//# sourceMappingURL=overridable-registry.d48fc2bee89fe968742c.js.map