"use strict";(self.webpackChunkinvenio_assets=self.webpackChunkinvenio_assets||[]).push([[5097],{9300:(e,t,n)=>{n.d(t,{w:()=>qe});var r=n(80296),a=n(96540),o=n(93682),l=n(3487),i=n(76217),s=n(23029),c=n(92901),u=n(56822),d=n(53954),p=n(85501),m=n(64467),f=n(25633),h=n(28085),v=n(98591),A=n(27089),g=n(48423),E=n(94157),b=n(5556),y=n.n(b),k=n(10467),w=n(54756),C=n.n(w),M=n(28930),x=n(81057),R=n(45458),S=n(62193),q=n.n(S),O=n(87395),_=n(53959),D=n(1489),N=n(92257),P=n(34667);function j(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(j=function(){return!!e})()}var T=function(e){function t(e){var n,r,a,o;(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a);var l=(n=(0,u.A)(r,j()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o))).props.record,i=(null===l||void 0===l?void 0:l.is_draft)||null===(null===l||void 0===l?void 0:l.is_draft);return n.state={description:void 0,expiresAt:void 0,permission:i?$[1].key:$[0].key},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.permission,r=t.expiresAt,o=t.description,s=this.props,c=s.handleCreation,u=s.loading,d=s.dropdownOptions;return a.createElement(_.A.Row,null,a.createElement(_.A.Cell,{width:16},a.createElement(D.A,null,a.createElement(D.A.Column,{width:4},a.createElement(N.A,{id:"access-request-description",onChange:function(t,n){return e.setState({description:n.value})},fluid:!0}),a.createElement("label",{htmlFor:"access-request-description",className:"helptext mb-0 mt-10"},E.M.t("Short name for your link (optional)."))),a.createElement(D.A.Column,{width:4},a.createElement(N.A,{id:"access-request-expires-at",onChange:function(t,n){e.setState({expiresAt:n.value})},fluid:!0,placeholder:E.M.t("Expiration date format: YYYY-MM-DD")}),a.createElement("label",{htmlFor:"access-request-expires-at",className:"helptext mb-0 mt-10"},E.M.t("Expiration date: YYYY-MM-DD or never if blank (optional)."))),a.createElement(D.A.Column,{width:4},a.createElement(P.A,{placeholder:E.M.t("Select permissions"),fluid:!0,selection:!0,onChange:function(t,n){return e.setState({permission:n.value})},options:d,defaultValue:n})),a.createElement(D.A.Column,{width:4,textAlign:"right"},a.createElement(l.A,{onClick:function(){return c(n,r,o)},icon:!0,loading:u,disabled:u,labelPosition:"left",positive:!0},a.createElement(i.A,{name:"code branch"}),E.M.t("Create a new link"))))))}}])}(a.Component);T.propTypes={handleCreation:y().func.isRequired,loading:y().bool.isRequired,dropdownOptions:y().array.isRequired,record:y().object.isRequired};var U=n(38992),B=n(69521);function I(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(I=function(){return!!e})()}var G=function(e){var t;return(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||(null===e||void 0===e?void 0:e.message)},F=function(e){function t(e){var n,r,a,o;return(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,I()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onSuccess",function(){return n.setState({loading:!1,actionSuccess:!0,error:void 0})}),(0,m.A)(n,"handleUpdate",function(){var e=(0,k.A)(C().mark(function e(t){var r,a,o,l,i,s,c,u,d;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props,a=r.updateEndpoint,o=r.onPermissionChanged,l=r.result,i=r.entityType,s={permission:t},n.setState({loading:!0,actionSuccess:!1}),n.cancellableAction=(0,x.withCancel)(x.http.patch(a,s)),e.prev=1,e.next=2,Promise.all([new Promise(function(e){return setTimeout(e,400)}),n.cancellableAction.promise]);case 2:n.onSuccess(),o(null!==(c=null===l||void 0===l||null===(u=l.subject)||void 0===u?void 0:u.id)&&void 0!==c?c:l.id,s.permission,i),e.next=5;break;case 3:if(e.prev=3,"UNMOUNTED"!==(d=e.catch(1))){e.next=4;break}return e.abrupt("return");case 4:n.setState({loading:!1,actionSuccess:!1,error:G(d)}),console.error(d);case 5:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}()),n.state={error:void 0,loading:!1,actionSuccess:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this,t=this.props,n=t.result,r=t.dropdownOptions,o=this.state,l=o.loading,i=o.actionSuccess,s=o.error;return a.createElement("div",{className:"flex align-items-center access-dropdown-container"},a.createElement(P.A,{className:"overflow-scroll",placeholder:E.M.t("Select permissions"),fluid:!0,loading:l,selection:!0,options:r,onChange:function(t,n){return e.handleUpdate(n.value)},defaultValue:n.permission}),a.createElement("div",{className:"ml-5 action-status-container"},i&&a.createElement(B.BK,{timeOutDelay:3e3,show:i}),s&&a.createElement(B.rt,{error:s})))}}])}(a.Component);F.propTypes={result:y().object.isRequired,dropdownOptions:y().array.isRequired,updateEndpoint:y().string.isRequired,entityType:y().string.isRequired,onPermissionChanged:y().func.isRequired};var L=n(92516),z=n.n(L),Y=n(2543),H=function(e){var t,n=e.result,s=e.record,c=e.onItemAddedOrDeleted,u=e.onPermissionChanged,d=e.dropdownOptions,p=(0,a.useState)(!1),m=(0,r.A)(p,2),f=m[0],h=m[1],v=(0,a.useState)(!1),A=(0,r.A)(v,2),g=A[0],b=A[1],y=(0,a.useState)(void 0),w=(0,r.A)(y,2),M=w[0],R=w[1],S=void 0;(0,a.useEffect)(function(){return function(){S&&S.cancel()}},[S]);var q=function(){var e=(0,k.A)(C().mark(function e(){var t;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),S=(0,x.withCancel)(x.http.delete("".concat(s.links.access_links,"/").concat(n.id))),e.prev=1,e.next=2,S.promise;case 2:b(!1),c(s.links.access_links,"links"),e.next=4;break;case 3:e.prev=3,t=e.catch(1),b(!1),R(t),console.error(t);case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),O=a.createRef();(0,a.useEffect)(function(){var e;null===(e=O.current)||void 0===e||e.focus()},[O]),(0,a.useEffect)(function(){var e=setTimeout(function(){h(!1)},1500);return function(){clearTimeout(e)}},[f]);return a.createElement(_.A.Row,{key:n.id},M&&a.createElement(x.ErrorMessage,{header:E.M.t("Something went wrong"),content:(null===M||void 0===M||null===(t=M.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||M.message,icon:"exclamation",negative:!0,size:"mini"}),!M&&a.createElement(a.Fragment,null,a.createElement(_.A.Cell,{width:3,"data-label":E.M.t("Link title")},(0,Y.isEmpty)(n.description)?"-":z()(n.description,{length:60})),a.createElement(_.A.Cell,{width:3,"data-label":E.M.t("Created")},(0,U.$)(n.created_at)),a.createElement(_.A.Cell,{width:3,"data-label":E.M.t("Expires at")},(0,Y.isEmpty)(n.expires_at)?E.M.t("Never"):"".concat((0,U.$)(n.expires_at)," (").concat(n.expires_at,")")),a.createElement(_.A.Cell,{width:3,"data-label":E.M.t("Access")},a.createElement(F,{updateEndpoint:"".concat(s.links.access_links,"/").concat(n.id),dropdownOptions:d,result:n,onPermissionChanged:u,entityType:"links"})),a.createElement(_.A.Cell,{width:4},a.createElement(l.A,{loading:g,disabled:g,onClick:q,icon:!0,labelPosition:"left",negative:!0,size:"small"},a.createElement(i.A,{name:"trash"}),E.M.t("Delete")),a.createElement(o.A,{position:"top center",content:E.M.t("Copied!"),inverted:!0,open:f,on:"click",size:"small",trigger:a.createElement(l.A,{ref:O,onClick:function(){return function(){var e="";"view"===(null===n||void 0===n?void 0:n.permission)?e="".concat(s.links.record_html||s.links.self_html,"?"):"preview"===(null===n||void 0===n?void 0:n.permission)?e="".concat(s.links.preview_html,"&"):"edit"===(null===n||void 0===n?void 0:n.permission)&&(e="".concat(s.links.self_html,"?"));var t="".concat(e,"token=").concat(n.token);navigator.clipboard.writeText(t),h(!0)}(null===n||void 0===n||n.id)},"aria-label":E.M.t("Copy link"),size:"small",icon:!0,labelPosition:"left"},a.createElement(i.A,{name:"copy outline"}),E.M.t("Copy link"))}))))};H.propTypes={result:y().object.isRequired,record:y().object.isRequired,onItemAddedOrDeleted:y().func.isRequired,onPermissionChanged:y().func.isRequired,dropdownOptions:y().array.isRequired};var V=n(88055),K=n.n(V);function W(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(W=function(){return!!e})()}var $=[{key:"view",name:"view",text:E.M.t("Can view"),title:E.M.t("Can view"),value:"view",description:E.M.t("Can view restricted files of all versions of this record.")},{key:"preview",name:"preview",text:E.M.t("Can preview drafts"),title:E.M.t("Can preview drafts"),value:"preview",description:E.M.t("Can view drafts, restricted files, and comment on associated draft requests of all versions of this record.")},{key:"edit",name:"edit",text:E.M.t("Can edit"),title:E.M.t("Can edit"),value:"edit",description:E.M.t("Can edit drafts, view restricted files, and comment on associated draft requests of all versions of this record.")}],J=function(e){function t(e){var n,r,o,l;return(0,s.A)(this,t),r=this,o=t,l=[e],o=(0,d.A)(o),n=(0,u.A)(r,W()?Reflect.construct(o,l||[],(0,d.A)(r).constructor):o.apply(r,l)),(0,m.A)(n,"errorMessage",function(){var e,t,r=n.state.error,o=(null===r||void 0===r||null===(e=r.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||(null===r||void 0===r?void 0:r.message),l=null===r||void 0===r||null===(t=r.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.errors;return a.createElement(O.A,{className:"mb-30",negative:!0},o,l&&l.map(function(e){return a.createElement(O.A.Item,{key:e.field},a.createElement("b",null,e.field.charAt(0).toUpperCase()+e.field.slice(1).replace("_"," ")),": ",n.renderErrorMessages(e.messages))}))}),(0,m.A)(n,"handleCreation",function(){var e=(0,k.A)(C().mark(function e(t,r,a){var o,l,i,s,c;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.props,l=o.onItemAddedOrDeleted,i=o.record,n.setState({loading:!0}),e.prev=1,s={permission:t,expires_at:r,description:a},n.cancellableAction=(0,x.withCancel)(x.http.post(i.links.access_links,s)),e.next=2,n.cancellableAction.promise;case 2:l(i.links.access_links,"links"),n.setState({loading:!1,error:void 0}),e.next=5;break;case 3:if(e.prev=3,"UNMOUNTED"!==(c=e.catch(1))){e.next=4;break}return e.abrupt("return");case 4:n.setState({loading:!1,error:c}),console.error(c);case 5:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t,n,r){return e.apply(this,arguments)}}()),(0,m.A)(n,"generateDropdownOptions",function(){var e=n.props.record,t=K()($);(null!==e&&void 0!==e&&e.is_draft||null===(null===e||void 0===e?void 0:e.is_draft))&&(t.find(function(e){return"view"===e.key}).text=E.M.t("Can view (view access link can be created only after the record is published)"));var r=(0,x.dropdownOptionsGenerator)(t);(null!==e&&void 0!==e&&e.is_draft||null===(null===e||void 0===e?void 0:e.is_draft))&&(r.find(function(e){return"view"===e.key}).disabled=!0);return r}),n.state={loading:!1,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"renderErrorMessages",value:function(e){var t=(0,R.A)(new Set(e));return 1===t.length?e[0]:a.createElement("ul",null,t.map(function(e){return a.createElement("li",{key:e},e)}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.results,r=t.record,o=t.onItemAddedOrDeleted,l=t.onPermissionChanged,i=this.state,s=i.loading,c=i.error;return a.createElement(a.Fragment,null,c&&this.errorMessage(),a.createElement(_.A,{className:"fixed-header"},a.createElement(_.A.Header,null,a.createElement(_.A.Row,null,a.createElement(_.A.HeaderCell,{"data-label":"Link title",width:3},E.M.t("Link title")),a.createElement(_.A.HeaderCell,{"data-label":"Created",width:3},E.M.t("Created")),a.createElement(_.A.HeaderCell,{"data-label":"Expires at",width:3},E.M.t("Expires")),a.createElement(_.A.HeaderCell,{"data-label":"Access",width:3},E.M.t("Access")),a.createElement(_.A.HeaderCell,{width:4}))),a.createElement(_.A.Body,null,s?a.createElement(M.A,null):q()(n)?a.createElement(_.A.Row,{textAlign:"center"},a.createElement("p",{className:"mt-10"},a.createElement("i",null,a.createElement("h5",null,E.M.t("This record has no links generated yet."))))):n.map(function(t){return a.createElement(H,{key:t.id,result:t,record:r,onItemAddedOrDeleted:o,onPermissionChanged:l,dropdownOptions:"view"===t.permission?(0,x.dropdownOptionsGenerator)($):e.generateDropdownOptions()})}))),a.createElement(_.A,{color:"green"},a.createElement(T,{handleCreation:this.handleCreation,loading:s,record:r,dropdownOptions:this.generateDropdownOptions()})))}}])}(a.Component);function Q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Q=function(){return!!e})()}J.propTypes={results:y().array.isRequired,record:y().object.isRequired,onItemAddedOrDeleted:y().func.isRequired,onPermissionChanged:y().func.isRequired};var X=function(e){function t(e){var n,r,a,o;return(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,Q()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onLinksAddedOrDeleted",(0,k.A)(C().mark(function e(){return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,n.fetchLinks(!0);case 1:case"end":return e.stop()}},e)}))),(0,m.A)(n,"onPermissionChanged",function(e,t){n.props.results.forEach(function(n){n.id===e&&(n.permission=t)})}),(0,m.A)(n,"fetchLinks",function(){var e=(0,k.A)(C().mark(function e(t){var r,a,o,l,i,s;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props,a=r.record,o=r.results,l=r.updateLinksState,!o||t){e.next=1;break}return e.abrupt("return");case 1:return n.setState({loading:!0}),e.prev=2,n.cancellableAction=(0,x.withCancel)(x.http.get(a.links.access_links)),e.next=3,n.cancellableAction.promise;case 3:i=e.sent,n.setState({loading:!1,error:void 0}),l(i.data.hits.hits,t),e.next=6;break;case 4:if(e.prev=4,"UNMOUNTED"!==(s=e.catch(2))){e.next=5;break}return e.abrupt("return");case 5:n.setState({loading:!1,error:s}),console.error(s);case 6:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}()),n.state={loading:!1,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentDidMount",value:function(){this.fetchLinks()}},{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e,t=this.props,n=t.record,r=t.results,o=this.state,l=o.loading,i=o.error;return a.createElement(a.Fragment,null,i&&a.createElement(x.ErrorMessage,{header:E.M.t("Something went wrong"),content:(null===i||void 0===i||null===(e=i.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||i.message,icon:"exclamation",negative:!0,size:"mini"}),a.createElement(g.A.Content,{className:"share-content"},l&&a.createElement(M.A,null),!l&&void 0!==r&&a.createElement(J,{results:r,record:n,onItemAddedOrDeleted:this.onLinksAddedOrDeleted,onPermissionChanged:this.onPermissionChanged})))}}])}(a.Component);X.propTypes={record:y().string.isRequired,results:y().array.isRequired,updateLinksState:y().func.isRequired};var Z=n(61448),ee=n.n(Z);function te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(te=function(){return!!e})()}var ne=function(e){function t(e){var n,r,a,o;(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,te()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"handleOnChange",function(e){var t=e.data;e.formikProps.form.setFieldValue("secret_link_expiration",t.value)});var l=e.expirationOptions;return n.expirationOptions=l,n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e=this.props,t=e.inline,n=e.expirationOptions,r=e.value,o=r?r.toString():n[0].value;return a.createElement(x.SelectField,{label:E.M.t("Link expiration"),inline:t,fieldPath:"secret_link_expiration",options:this.expirationOptions,onChange:this.handleOnChange,value:o,defaultValue:n[0]})}}])}(a.Component);ne.propTypes={expirationOptions:y().arrayOf(y().shape({key:y().string.isRequired,text:y().string.isRequired,value:y().string.isRequired})),inline:y().bool,value:y().string},ne.defaultProps={expirationOptions:[{key:0,text:E.M.t("Never"),value:"0"},{key:30,text:E.M.t("In 1 month"),value:"30"},{key:60,text:E.M.t("In 2 months"),value:"60"},{key:180,text:E.M.t("In 6 months"),value:"180"},{key:365,text:E.M.t("In 1 year"),value:"365"}],inline:!1,value:void 0};var re=n(80501),ae=n(50363),oe=n(36713),le=n(17684),ie=n(15941),se=n(58156),ce=n.n(se);function ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function de(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(de=function(){return!!e})()}var pe=function(e){function t(e){var n,r,a,o;return(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,de()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"accessRequestSchema",ie.Ik({allow_user_requests:ie.lc(),allow_guest_requests:ie.lc(),accept_conditions_text:ie.Yj().nullable(),secret_link_expiration:ie.Yj()})),(0,m.A)(n,"handleSubmit",function(){var e=(0,k.A)(C().mark(function e(t){var r,a,o,l,i,s,c;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0,actionSuccess:!1}),r=n.props,a=r.record,o=r.successCallback,l={allow_user_requests:t.allow_user_requests,allow_guest_requests:t.allow_guest_requests,accept_conditions_text:t.accept_conditions_text,secret_link_expiration:t.secret_link_expiration},n.cancellableAction=(0,x.withCancel)(x.http.put(a.links.access,l)),e.prev=1,e.next=2,n.cancellableAction.promise;case 2:i=e.sent,n.setState({loading:!1,actionSuccess:!0,error:void 0}),o(i.data),e.next=5;break;case 3:if(e.prev=3,"UNMOUNTED"!==(c=e.catch(1))){e.next=4;break}return e.abrupt("return");case 4:n.setState({error:(null===c||void 0===c||null===(s=c.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.message)||(null===c||void 0===c?void 0:c.message),loading:!1,actionSuccess:!1}),console.error(c);case 5:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}()),(0,m.A)(n,"initFormValues",function(){var e=n.props.record.parent.access.settings;return ee()(e,"secret_link_expiration")||(e.secret_link_expiration=0),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(n),!0).forEach(function(t){(0,m.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e)}),n.state={loading:!1,error:void 0,actionSuccess:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.error,r=e.actionSuccess,o=this.props.handleClose;return a.createElement(le.Formik,{onSubmit:this.handleSubmit,enableReinitialize:!0,initialValues:this.initFormValues(),validationSchema:this.accessRequestSchema},function(e){var i=e.values,s=e.handleSubmit;return a.createElement(a.Fragment,null,a.createElement(g.A.Content,{className:"share-content"},n&&a.createElement(x.ErrorMessage,{header:E.M.t("Unable to change the access request settings."),content:E.M.t(n),icon:"exclamation",className:"text-align-left",negative:!0}),a.createElement(D.A,null,a.createElement(re.A,null,a.createElement(D.A,null,a.createElement(D.A.Row,null,a.createElement(D.A.Column,{width:16},a.createElement(re.A.Field,null,a.createElement(x.RadioField,{checked:ce()(i,"allow_user_requests"),control:ae.A,fieldPath:"allow_user_requests",label:E.M.t("Allow authenticated users to request access to restricted files."),onChange:function(e){var t=e.data;e.formikProps.form.setFieldValue("allow_user_requests",t.checked)}})),a.createElement(re.A.Field,null,a.createElement(x.RadioField,{checked:ce()(i,"allow_guest_requests"),control:ae.A,fieldPath:"allow_guest_requests",label:E.M.t("Allow non-authenticated users to request access to restricted files."),onChange:function(e){var t=e.data;e.formikProps.form.setFieldValue("allow_guest_requests",t.checked)}})),a.createElement("label",{className:"helptext mb-0 mt-10"},E.M.t("Enable users and guests to request access to your record's files. When access is requested by someone, you will get an e-mail asking for approval. After you approve a request, users will be granted access and guests will receive a secret link.")))),a.createElement(D.A.Row,null,a.createElement(D.A.Column,null,a.createElement("h5",null,E.M.t("Accept conditions")),a.createElement("label",{className:"helptext mb-0 mt-10"},E.M.t("Optional. Specify conditions under which you approve access. This message will be visible for any user when requesting access to this record.")),a.createElement(re.A.Field,null,a.createElement(x.RichInputField,{fieldPath:"accept_conditions_text"}))))),a.createElement("h5",null,E.M.t("Advanced options")),a.createElement(oe.A,null),a.createElement(D.A,null,a.createElement(D.A.Row,null,a.createElement(D.A.Column,{width:3},a.createElement(re.A.Field,null,a.createElement(ne,{inline:!0,value:i.secret_link_expiration})))))),a.createElement(D.A.Row,null,a.createElement(D.A.Column,null,a.createElement("br",null))))),a.createElement(g.A.Actions,null,r&&a.createElement(B.BK,{className:"ml-10",timeOutDelay:3e3,show:r}),a.createElement(l.A,{size:"small",onClick:o,floated:"left",content:E.M.t("Cancel"),icon:"remove"}),a.createElement(l.A,{size:"small",labelPosition:"left",icon:"checkmark",primary:!0,content:E.M.t("Save"),onClick:function(e){return s(e)},loading:t,disabled:t})))})}}])}(a.Component);pe.propTypes={record:y().string.isRequired,successCallback:y().func.isRequired,handleClose:y().func.isRequired};var me=n(23848),fe=(0,c.A)(function e(t){var n=this;(0,s.A)(this,e),(0,m.A)(this,"createGrants",function(){var e=(0,k.A)(C().mark(function e(t,a,o,l){var i,s,c,u,d,p,m,f;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],s=0,c=Object.entries(t);s<c.length;s++)u=(0,r.A)(c[s],2),d=u[0],p=u[1],m={subject:{type:p.type,id:d},permission:a},l&&(m.notify=l),o&&(m.message=o),i.push(m);return f={grants:i},e.next=1,x.http.post(n.endpoint,f);case 1:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}()),this.endpoint=t.links.access_grants}),he=n(4252);function ve(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ve=function(){return!!e})()}var Ae=function(e){function t(e){var n,r,a,o;return(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,ve()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onSuccess",function(){var e=n.props,t=e.onGrantAddedOrDeleted,r=e.endpoint,a=e.searchType;t("".concat(r,"?expand=true"),a),n.handleCloseModal()}),(0,m.A)(n,"updateMessage",function(e){n.setState({message:e})}),(0,m.A)(n,"handleNotifyCheckboxClick",function(){var e=n.state.notifyUser;n.setState({notifyUser:!e})}),(0,m.A)(n,"handleOpenModal",function(){return n.setState({open:!0})}),(0,m.A)(n,"handleCloseModal",function(){n.setState({open:!1,notifyUser:!0})}),(0,m.A)(n,"searchEntities",function(){var e=n.props.searchType;return"user"===e?(new he.lK).suggestUsers:"role"===e?(new he.D4).getGroups:void 0}),n.state={open:!1,notifyUser:!0,message:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e,t=this,n=this.props,r=n.results,o=n.record,i=n.isComputer,s=n.accessDropdownOptions,c=n.searchType,u=this.state,d=u.open,p=u.notifyUser,m=u.message,f=new fe(o),h=[null===(e=o.parent)||void 0===e||null===(e=e.access)||void 0===e||null===(e=e.owned_by)||void 0===e?void 0:e.user];r.forEach(function(e){var t;h.push(null===e||void 0===e||null===(t=e.subject)||void 0===t?void 0:t.id)});var v="",A="",b="",y="",k="",w="";return"user"===c&&(v=E.M.t("Add people"),A=E.M.t("User"),b=E.M.t("No selected users"),y=E.M.t("Search for users to grant access (only users with a public profile can be invited)"),k=E.M.t("Search by email, full name or username"),w=E.M.t("users")),"role"===c&&(v=E.M.t("Add groups"),A=E.M.t("Group"),b=E.M.t("No selected groups"),k=E.M.t("Search for groups"),w=E.M.t("groups")),a.createElement(g.A,{role:"dialog",closeIcon:!0,onClose:this.handleCloseModal,onOpen:this.handleOpenModal,closeOnDimmerClick:!1,open:d,"aria-label":v,trigger:a.createElement(l.A,{className:i?"":"mobile only tablet only mb-15",content:v,positive:!0,size:"medium",icon:"plus",labelPosition:"left",floated:i?void 0:"right"})},a.createElement(g.A.Header,{as:"h2"},v),a.createElement(B.Lr,{key:"access-users",roleOptions:s,modalClose:this.handleCloseModal,action:f.createGrants,fetchMembers:this.searchEntities(),onSuccessCallback:this.onSuccess,searchBarTitle:a.createElement("label",null,A),searchBarTooltip:y,doneButtonText:E.M.t("Add"),doneButtonIcon:"plus",radioLabel:E.M.t("Access"),selectedItemsHeader:b,message:m,searchType:c,messageComponent:a.createElement(a.Fragment,null,a.createElement(ae.A,{checked:p,className:"mb-20 mt-10",label:E.M.t("Notify people"),onClick:this.handleNotifyCheckboxClick}),p&&a.createElement(a.Fragment,null,a.createElement("p",null,a.createElement("b",null,E.M.t("Notification message"))),a.createElement(x.RichEditor,{inputValue:function(){return m},onBlur:function(e,n){t.updateMessage(n.getContent())}}))),notify:p,doneButtonTip:E.M.t("You are about to add"),doneButtonTipType:w,existingEntities:h,existingEntitiesDescription:E.M.t("Access already granted"),searchBarPlaceholder:k}))}}])}(a.Component);function ge(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ge=function(){return!!e})()}Ae.propTypes={record:y().object.isRequired,results:y().array.isRequired,isComputer:y().bool.isRequired,accessDropdownOptions:y().array.isRequired,onGrantAddedOrDeleted:y().func.isRequired,endpoint:y().string.isRequired,searchType:y().oneOf(["group","role","user"]).isRequired};var Ee=[].concat((0,R.A)($),[{key:"manage",name:"manage",text:E.M.t("Can manage"),title:E.M.t("Can manage"),value:"manage",description:E.M.t("Can manage access, edit drafts, view restricted files, and comment on associated draft requests of all versions of this record.")}]),be=function(e){function t(e){var n,r,a,o;return(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,ge()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"handleDelete",(0,k.A)(C().mark(function e(){var t,r,a,o,l,i;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props,a=r.result,o=r.endpoint,n.setState({loading:!0}),l=(0,x.withCancel)(x.http.delete("".concat(o,"/").concat(null===a||void 0===a||null===(t=a.expanded)||void 0===t||null===(t=t.subject)||void 0===t?void 0:t.id))),e.prev=1,e.next=2,l.promise;case 2:n.setState({loading:!1,success:!0}),n.handleSuccess(),e.next=4;break;case 3:e.prev=3,i=e.catch(1),n.setState({loading:!1,error:i}),console.error(i);case 4:case"end":return e.stop()}},e,null,[[1,3]])}))),(0,m.A)(n,"handleSuccess",function(){var e=n.props,t=e.onGrantAddedOrDeleted,r=e.endpoint,a=e.searchType;t("".concat(r,"?expand=true"),a)}),n.state={loading:!1,success:void 0,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e,t,n,r,o,i,s=this.props,c=s.result,u=s.permissions,d=s.endpoint,p=s.searchType,m=s.onPermissionChanged,f=this.state,v=f.loading,A=f.success,g=f.error,b=c.expanded.subject;return a.createElement(_.A.Row,null,g&&a.createElement(x.ErrorMessage,{header:E.M.t("Something went wrong"),content:(null===g||void 0===g||null===(e=g.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||g.message,icon:"exclamation",negative:!0,size:"mini"}),!g&&a.createElement(a.Fragment,null,a.createElement(_.A.Cell,{width:8},a.createElement(D.A,{textAlign:"left",verticalAlign:"middle"},a.createElement(D.A.Column,null,a.createElement(me.A,{className:"flex",key:c.id},a.createElement(x.Image,{src:null===(t=b.links)||void 0===t?void 0:t.avatar,avatar:!0,className:"rel-ml-1",alt:""}),a.createElement(me.A.Content,{className:"ml-10 p-0"},a.createElement(me.A.Header,{className:"flex align-items-center ".concat(b.description?"":"mt-5")},a.createElement("b",{className:"mr-10"},(null===(n=b.profile)||void 0===n?void 0:n.full_name)||(null===b||void 0===b?void 0:b.username)||(null===b||void 0===b?void 0:b.name)),b.is_current_user&&a.createElement(h.A,{size:"tiny",className:"primary"},E.M.t("You"))),(null===(r=b.profile)||void 0===r?void 0:r.affiliations)&&a.createElement(me.A.Meta,null,null===(o=b.profile)||void 0===o?void 0:o.affiliations)))))),a.createElement(_.A.Cell,{"data-label":E.M.t("Access"),width:4},a.createElement(F,{updateEndpoint:"".concat(d,"/").concat(null===c||void 0===c||null===(i=c.expanded)||void 0===i||null===(i=i.subject)||void 0===i?void 0:i.id),dropdownOptions:(0,x.dropdownOptionsGenerator)(Ee),result:c,onPermissionChanged:m,entityType:p})),a.createElement(_.A.Cell,{"data-label":E.M.t("Actions"),textAlign:"center",width:3},a.createElement("div",null,u.can_manage&&a.createElement(a.Fragment,null,A&&a.createElement(B.BK,{timeOutDelay:3e3,show:A}),a.createElement(l.A,{size:"small",labelPosition:"left",icon:"trash",className:"fluid-computer-only",compact:!0,negative:!0,disabled:v,loading:v,content:E.M.t("Delete"),onClick:this.handleDelete}))))))}}])}(a.Component);function ye(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ye=function(){return!!e})()}be.propTypes={result:y().object.isRequired,permissions:y().object.isRequired,onGrantAddedOrDeleted:y().func.isRequired,onPermissionChanged:y().func.isRequired,endpoint:y().string.isRequired,searchType:y().oneOf(["group","role","user"]).isRequired};var ke=function(e){function t(){return(0,s.A)(this,t),e=this,n=t,r=arguments,n=(0,d.A)(n),(0,u.A)(e,ye()?Reflect.construct(n,r||[],(0,d.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e,t,n,r,o,l,i=this.props,s=i.record,c=i.permissions,u=i.endpoint,d=i.searchType,p=i.results,m=i.loading,f=i.error,v=i.onGrantAddedOrDeleted,b=i.onPermissionChanged,y=null===s||void 0===s||null===(e=s.expanded)||void 0===e||null===(e=e.parent)||void 0===e||null===(e=e.access)||void 0===e?void 0:e.owned_by,k="",w="";return"user"===d&&(k=E.M.t("No user has access to this record yet."),w=E.M.t("People with access")),"role"===d&&(k=E.M.t("No group has access to this record yet."),w=E.M.t("Groups with access")),a.createElement(a.Fragment,null,f&&a.createElement(x.ErrorMessage,{header:E.M.t("Something went wrong"),content:(null===f||void 0===f||null===(t=f.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||f.message,icon:"exclamation",className:"text-align-left",negative:!0,size:"mini"}),a.createElement(g.A.Content,{className:"share-content"},m&&a.createElement(M.A,{isLoading:!0,active:!0}),!m&&void 0!==p&&a.createElement(a.Fragment,null,a.createElement(Ae,{isComputer:!1,accessDropdownOptions:Ee,results:p,record:s,onGrantAddedOrDeleted:v,searchType:d,endpoint:u}),a.createElement(_.A,{className:"fixed-header"},a.createElement(_.A.Header,null,a.createElement(_.A.Row,null,a.createElement(_.A.HeaderCell,{width:8},w),a.createElement(_.A.HeaderCell,{"data-label":"Access",width:4},E.M.t("Access")),a.createElement(_.A.HeaderCell,{textAlign:"center",width:3},a.createElement(Ae,{isComputer:!0,accessDropdownOptions:Ee,results:p,record:s,onGrantAddedOrDeleted:v,searchType:d,endpoint:u})))),a.createElement(_.A.Body,null,"user"===d&&y&&a.createElement(_.A.Row,null,a.createElement(_.A.Cell,{width:8},a.createElement(D.A,{textAlign:"left",verticalAlign:"middle"},a.createElement(D.A.Column,null,a.createElement(me.A,{className:"flex"},a.createElement(x.Image,{src:null===(n=y.links)||void 0===n?void 0:n.avatar,avatar:!0,className:"rel-ml-1",alt:""}),a.createElement(me.A.Content,{className:"ml-10 p-0"},a.createElement(me.A.Header,{className:"flex align-items-center ".concat(y.description?"":"mt-5")},a.createElement("b",{className:"mr-10"},(null===(r=y.profile)||void 0===r?void 0:r.full_name)||y.username),y.is_current_user&&a.createElement(h.A,{size:"tiny",className:"primary"},E.M.t("You"))),(null===(o=y.profile)||void 0===o?void 0:o.affiliations)&&a.createElement(me.A.Meta,null,null===(l=y.profile)||void 0===l?void 0:l.affiliations)))))),a.createElement(_.A.Cell,{textAlign:"left","data-label":E.M.t("Access"),width:4},E.M.t("Owner")),a.createElement(_.A.Cell,{width:3})),p.map(function(e){return a.createElement(be,{key:e.subject.id,result:e,permissions:c,onGrantAddedOrDeleted:v,onPermissionChanged:b,endpoint:u,searchType:d})})))),!m&&!f&&q()(p)&&a.createElement(A.A,{className:"mt-10",textAlign:"center"},a.createElement("h5",null,k))))}}])}(a.Component);function we(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(we=function(){return!!e})()}ke.propTypes={record:y().object.isRequired,permissions:y().object.isRequired,endpoint:y().string.isRequired,searchType:y().oneOf(["group","role","user"]).isRequired,onGrantAddedOrDeleted:y().func.isRequired,onPermissionChanged:y().func.isRequired,results:y().array.isRequired,loading:y().bool.isRequired,error:y().object.isRequired};var Ce=function(e){function t(e){var n,r,a,o;return(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,we()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onUserAddedOrDeleted",(0,k.A)(C().mark(function e(){return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,n.fetchUsers(!0);case 1:case"end":return e.stop()}},e)}))),(0,m.A)(n,"onPermissionChanged",function(e,t){n.props.results.forEach(function(n){n.subject.id===e&&(n.permission=t)})}),(0,m.A)(n,"fetchUsers",function(){var e=(0,k.A)(C().mark(function e(t){var r,a,o,l,i,s;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props,a=r.record,o=r.results,l=r.updateUsersState,!o||t){e.next=1;break}return e.abrupt("return");case 1:return n.setState({loading:!0}),e.prev=2,n.cancellableAction=(0,x.withCancel)(x.http.get("".concat(a.links.access_users,"?expand=true"))),e.next=3,n.cancellableAction.promise;case 3:i=e.sent,n.setState({loading:!1,error:void 0}),l(i.data.hits.hits,t),e.next=6;break;case 4:if(e.prev=4,"UNMOUNTED"!==(s=e.catch(2))){e.next=5;break}return e.abrupt("return");case 5:n.setState({loading:!1,error:s}),console.error(s);case 6:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}()),n.state={loading:!1,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentDidMount",value:function(){this.fetchUsers()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.error,r=this.props,o=r.record,l=r.permissions,i=r.results;return a.createElement(ke,{searchType:"user",record:o,permissions:l,endpoint:"".concat(o.links.access_users),results:i,loading:t,error:n,onGrantAddedOrDeleted:this.onUserAddedOrDeleted,onPermissionChanged:this.onPermissionChanged})}}])}(a.Component);function Me(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Me=function(){return!!e})()}Ce.propTypes={record:y().object.isRequired,permissions:y().object.isRequired,results:y().array.isRequired,updateUsersState:y().func.isRequired};var xe=function(e){function t(e){var n,r,a,o;return(0,s.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,Me()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onGroupAddedOrDeleted",(0,k.A)(C().mark(function e(){return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,n.fetchGroups(!0);case 1:case"end":return e.stop()}},e)}))),(0,m.A)(n,"onPermissionChanged",function(e,t){n.props.results.forEach(function(n){n.subject.id===e&&(n.permission=t)})}),(0,m.A)(n,"fetchGroups",function(){var e=(0,k.A)(C().mark(function e(t){var r,a,o,l,i,s;return C().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props,a=r.record,o=r.results,l=r.updateGroupsState,!o||t){e.next=1;break}return e.abrupt("return");case 1:return n.setState({loading:!0}),e.prev=2,n.cancellableAction=(0,x.withCancel)(x.http.get("".concat(a.links.access_groups,"?expand=true"))),e.next=3,n.cancellableAction.promise;case 3:i=e.sent,n.setState({loading:!1,error:void 0}),l(i.data.hits.hits,t),e.next=6;break;case 4:if(e.prev=4,"UNMOUNTED"!==(s=e.catch(2))){e.next=5;break}return e.abrupt("return");case 5:n.setState({loading:!1,error:s}),console.error(s);case 6:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}()),n.state={loading:!1,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentDidMount",value:function(){this.fetchGroups()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.error,r=this.props,o=r.record,l=r.permissions,i=r.results;return a.createElement(ke,{searchType:"role",record:o,permissions:l,endpoint:"".concat(o.links.access_groups),results:i,loading:t,error:n,onGrantAddedOrDeleted:this.onGroupAddedOrDeleted,onPermissionChanged:this.onPermissionChanged})}}])}(a.Component);function Re(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Re=function(){return!!e})()}xe.propTypes={record:y().object.isRequired,permissions:y().object.isRequired,results:y().array.isRequired,updateGroupsState:y().func.isRequired};var Se=function(e){function t(e){var n,r,o,l;(0,s.A)(this,t),r=this,o=t,l=[e],o=(0,d.A)(o),n=(0,u.A)(r,Re()?Reflect.construct(o,l||[],(0,d.A)(r).constructor):o.apply(r,l)),(0,m.A)(n,"updateGroupsState",function(e,t){if(n.setState({groupsResults:e}),t){var r,a=n.state.record,o=null===a||void 0===a||null===(r=a.parent)||void 0===r||null===(r=r.access)||void 0===r||null===(r=r.grants)||void 0===r?void 0:r.filter(function(e){var t;return"role"!==(null===e||void 0===e||null===(t=e.subject)||void 0===t?void 0:t.type)}).concat(e);a.parent.access.grants=o,n.setState({record:a})}}),(0,m.A)(n,"updateUsersState",function(e,t){if(n.setState({usersResults:e}),t){var r,a=n.state.record,o=null===a||void 0===a||null===(r=a.parent)||void 0===r||null===(r=r.access)||void 0===r||null===(r=r.grants)||void 0===r?void 0:r.filter(function(e){var t;return"user"!==(null===e||void 0===e||null===(t=e.subject)||void 0===t?void 0:t.type)}).concat(e);a.parent.access.grants=o,n.setState({record:a})}}),(0,m.A)(n,"updateLinksState",function(e,t){if(n.setState({linksResults:e}),t){var r=n.state.record;r.parent.access.links=e,n.setState({record:r})}}),(0,m.A)(n,"handleTabChange",function(e,t){var r,a=t.activeIndex;n.setState({activeTabKey:null===t||void 0===t||null===(r=t.panes[a])||void 0===r||null===(r=r.menuItem)||void 0===r?void 0:r.key})}),(0,m.A)(n,"handleRecordUpdate",function(e){var t=n.state.record;e.expanded=t.expanded,n.setState({record:e})}),(0,m.A)(n,"panes",function(e,t){var r,o,l,s=n.props,c=s.handleClose,u=s.groupsEnabled,d=n.state,p=d.linksResults,m=d.groupsResults,g=d.usersResults,b=0,y=0;null===(r=e.parent)||void 0===r||null===(r=r.access)||void 0===r||null===(r=r.grants)||void 0===r||r.forEach(function(e){"user"===e.subject.type&&b++,"role"===e.subject.type&&y++}),null!==e&&void 0!==e&&null!==(o=e.expanded)&&void 0!==o&&null!==(o=o.parent)&&void 0!==o&&null!==(o=o.access)&&void 0!==o&&o.owned_by&&b++;var k=[{menuItem:a.createElement(f.A,{key:"accessUsers"},a.createElement(i.A,{name:"user"}),E.M.t("People"),a.createElement(h.A,{size:"tiny"},b)),render:function(){return a.createElement(v.A.Pane,{key:"accessUsers",as:A.A},a.createElement(Ce,{record:e,permissions:t,results:g,updateUsersState:n.updateUsersState}))}}];u&&k.push({menuItem:a.createElement(f.A,{key:"accessGroups"},a.createElement(i.A,{name:"users"}),E.M.t("Groups"),a.createElement(h.A,{size:"tiny"},y)),render:function(){return a.createElement(v.A.Pane,{key:"accessGroups",as:A.A},a.createElement(xe,{record:e,permissions:t,results:m,updateGroupsState:n.updateGroupsState}))}});var w=0;return null===(l=e.parent)||void 0===l||null===(l=l.access)||void 0===l||null===(l=l.links)||void 0===l||l.forEach(function(e){null!==e.id&&w++}),k.push({menuItem:a.createElement(f.A,{key:"accessLinks"},a.createElement(i.A,{name:"linkify"}),E.M.t("Links"),a.createElement(h.A,{size:"tiny"},w)),render:function(){return a.createElement(v.A.Pane,{key:"accessLinks",as:A.A},a.createElement(X,{results:p,record:e,updateLinksState:n.updateLinksState}))}},{menuItem:a.createElement(f.A,{key:"accessRequests"},a.createElement(i.A,{name:"cog"}),E.M.t("Settings")),render:function(){return a.createElement(v.A.Pane,{key:"accessRequests",as:A.A},a.createElement(pe,{record:e,handleClose:c,successCallback:n.handleRecordUpdate}))}}),k});var c=n.props.record;return n.state={record:c,usersResults:void 0,groupsResults:void 0,linksResults:void 0,activeTabKey:""},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e=this.props,t=e.open,n=e.handleClose,r=e.permissions,o=this.state,s=o.record,c="accessRequests"!==o.activeTabKey;return a.createElement(g.A,{open:t,closeIcon:!0,onClose:n,className:"record-share-modal",role:"dialog","aria-labelledby":"access-link-modal-header","aria-modal":"true","tab-index":"-1",size:"large",closeOnDimmerClick:!1},a.createElement(g.A.Header,{as:"h2",id:"access-link-modal-header"},a.createElement(i.A,{name:"share square"}),E.M.t("Share access")),a.createElement(v.A,{menu:{secondary:!0,pointing:!0},panes:this.panes(s,r),onTabChange:this.handleTabChange}),c&&a.createElement(g.A.Actions,{className:"ui clearing segment"},a.createElement(l.A,{size:"small",onClick:n,content:E.M.t("Close"),className:"left floated clearing"})))}}])}(a.Component);Se.propTypes={record:y().object.isRequired,open:y().bool.isRequired,groupsEnabled:y().bool.isRequired,handleClose:y().func.isRequired,permissions:y().object.isRequired};var qe=function(e){var t=e.disabled,n=e.record,s=e.permissions,c=e.groupsEnabled,u=(0,a.useState)(!1),d=(0,r.A)(u,2),p=d[0],m=d[1];return a.createElement(a.Fragment,null,a.createElement(o.A,{content:E.M.t("You don't have permissions to share this record."),disabled:!t,trigger:a.createElement(l.A,{fluid:!0,onClick:function(){return m(!0)},disabled:t,primary:!0,size:"medium","aria-haspopup":"dialog",icon:!0,labelPosition:"left"},a.createElement(i.A,{name:"share square"}),E.M.t("Share"))}),a.createElement(Se,{open:p,handleClose:function(){return m(!1)},record:n,permissions:s,groupsEnabled:c}))};qe.propTypes={disabled:y().bool,record:y().object.isRequired,permissions:y().object.isRequired,groupsEnabled:y().bool.isRequired},qe.defaultProps={disabled:!1}},38992:(e,t,n)=>{n.d(t,{$:()=>c,h:()=>s});var r=n(58156),a=n.n(r),o=n(96540),l=n(94157),i=n(91272);function s(e){var t=e.creators,n=e.className,r=e.othersLink,i="creatibutor-wrap separated";function s(e){var t=a()(e,"person_or_org.identifiers",[]),n=a()(e,"person_or_org.name",l.M.t("No name"));return t.map(function(e){return function(e,t,n){var r=null,a=null,i=null,s="";switch(e){case"orcid":r="https://orcid.org/".concat(t),a=l.M.t("ORCID profile"),i="/static/images/orcid.svg",s=l.M.t("ORCID logo");break;case"ror":r="https://ror.org/".concat(t),a=l.M.t("ROR profile"),i="/static/images/ror-icon.svg",s=l.M.t("ROR logo");break;case"gnd":r="https://d-nb.info/gnd/".concat(t),a=l.M.t("GND profile"),i="/static/images/gnd-icon.svg",s=l.M.t("GND logo");break;default:return null}return o.createElement("a",{className:"no-text-decoration mr-0",href:r,"aria-label":"".concat(n,": ").concat(a),title:"".concat(n,": ").concat(a),key:e},o.createElement("img",{className:"inline-id-icon ml-5",src:i,alt:s}))}(e.scheme,e.identifier,n)})}n&&(i+=" ".concat(n));var c,u=t.slice(0,3).map(function(e){return o.createElement("span",{className:i,key:e.person_or_org.name},function(e){var t=a()(e,"person_or_org.name",l.M.t("No name"));return o.createElement("a",{className:"creatibutor-link",href:'/search?q=metadata.creators.person_or_org.name:"'.concat(t,'"'),title:"".concat(t,": ").concat(l.M.t("Search"))},o.createElement("span",{className:"creatibutor-name"},t))}(e),s(e))}),d=t.length-3;0<d&&(c=1===d?l.M.t("and {{count}} other",{count:d}):l.M.t("and {{count}} others",{count:d}),u.push(o.createElement("span",{className:i,key:c},o.createElement("a",{className:"creatibutor-link",href:r},o.createElement("span",{className:"creatibutor-name"},l.M.t(c,{count:d}))))));return u}var c=function(e){return i.DateTime.fromISO(e).setLocale(l.M.language).toRelative()}},58616:(e,t,n)=>{n.d(t,{c:()=>Y});var r=n(80296),a=n(96540),o=n(93682),l=n(3487),i=n(94157),s=n(5556),c=n.n(s),u=n(10467),d=n(23029),p=n(92901),m=n(56822),f=n(53954),h=n(85501),v=n(64467),A=n(54756),g=n.n(A),E=n(17684),b=n(81057),y=n(48423),k=n(12594),w=n(80501),C=n(17058),M=n(87395),x=n(76217),R=n(50363),S=n(53959),q=n(55190),O=n(35275),_=n(95374),D=n(95755),N=n(27196),P=n(15941),j=n(93635),T=n(63129),U=n(73591),B=function(e){var t=e.index,n=e.row,r=e.state,o=e.onStateChange;return a.createElement(O.A,{key:n.name},a.createElement(j.A,null,n.label),a.createElement(j.A,null,a.createElement(T.A,null,a.createElement(U.A,{value:"Yes",checked:!0===r[t],onChange:function(){return o(t,!0)}}))),a.createElement(j.A,null,a.createElement(T.A,null,a.createElement(U.A,{value:"No",checked:!1===r[t],onChange:function(){return o(t,!1)}}))))};B.propTypes={index:c().number.isRequired,row:c().object.isRequired,state:c().array.isRequired,onStateChange:c().func.isRequired};const I=B;function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach(function(t){(0,v.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(L=function(){return!!e})()}var z=function(e){function t(e){var n,r,a,o,l;(0,d.A)(this,t),a=this,o=t,l=[e],o=(0,f.A)(o),r=(0,m.A)(a,L()?Reflect.construct(o,l||[],(0,f.A)(a).constructor):o.apply(a,l)),(0,v.A)(r,"handleClose",function(){r.setState(F({},r.initState)),(0,r.props.handleClose)()}),(0,v.A)(r,"handleRadioUpdate",function(e,t){var n=r.props.recordDeletion,a=r.state.checklistState.map(function(n,r){return r===e?t:n}),o=n.checklist.filter(function(e,t){return a[t]}),l=o.map(function(e){return e.message});r.setState({checklistState:a,messages:l})}),(0,v.A)(r,"handleCheckboxUpdate",function(e){var t=r.state.checkboxState,n=t.map(function(n,r){return r===e?!t[r]:n});r.setState({checkboxState:n})}),(0,v.A)(r,"deletionRequestSchema",function(e){return e?P.Ik({reason:P.Yj().required("Required")}):P.Ik({reason:P.Yj().required("Required"),comment:P.Yj().min(25,"Please write at least 25 characters").required("Required")})}),(0,v.A)(r,"handleSubmit",function(){var e=(0,u.A)(g().mark(function e(t){var n,a,o,l,i;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.setState({loading:!0}),n=r.props.record,a={reason:t.reason,comment:t.comment},!("request_deletion"in n.links)){e.next=6;break}return r.cancellableAction=(0,b.withCancel)(b.http.post(n.links.request_deletion,a)),e.prev=1,e.next=2,r.cancellableAction.promise;case 2:o=e.sent,l=o.data,200===o.status?window.location.reload():201===o.status&&(window.location.href=l.links.self_html),e.next=4;break;case 3:e.prev=3,i=e.catch(1),r.setState({error:i}),console.error(i);case 4:return e.prev=4,r.setState({loading:!1}),e.finish(4);case 5:e.next=7;break;case 6:r.setState({error:"Could not submit deletion request",loading:!1});case 7:case"end":return e.stop()}},e,null,[[1,3,4,5]])}));return function(t){return e.apply(this,arguments)}}());var i=(null===(n=r.props.recordDeletion.checklist)||void 0===n?void 0:n.length)||0;return r.initState={loading:!1,error:void 0,checklistState:Array(i).fill(void 0),checkboxState:Array(2).fill(!1),messages:[]},r.state=F({},r.initState),r}return(0,h.A)(t,e),(0,p.A)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,r=t.recordDeletion,o=t.options,s=this.state,c=s.loading,u=s.error,d=s.checklistState,p=s.checkboxState,m=s.messages,f=r.checklist;if(!("recordDeletion"in r))return null;var h=r.recordDeletion.immediate_deletion.allowed,v=h?i.M.t("Delete record"):i.M.t("Request deletion"),A=h?i.M.t("Delete immediately"):i.M.t("Request deletion"),g=h?"negative":"primary",P=r.context.files,j=r.context.internalDoi,T=p.some(function(e){return!1===e})||d.some(function(e){return!0===e||void 0===e});return a.createElement(y.A,{open:n,closeIcon:!0,onClose:this.handleClose,role:"dialog","aria-modal":"true","tab-index":"-1",size:"tiny",closeOnDimmerClick:!1,onClick:function(e){return e.stopPropagation()},onKeyDown:function(e){return e.stopPropagation()}},a.createElement(k.A,null,v),a.createElement(E.Formik,{onSubmit:this.handleSubmit,validationSchema:this.deletionRequestSchema(h),initialValues:{reason:"",comment:""},validateOnChange:!1,validateOnBlur:!1},function(t){var n=t.handleSubmit;return a.createElement(w.A,null,a.createElement(C.A,null,a.createElement(a.Fragment,null,h?a.createElement("p",null,r.recordDeletion.immediate_deletion.policy.description):a.createElement("p",null,r.recordDeletion.request_deletion.policy.description),a.createElement(M.A,{negative:!0},a.createElement(x.A,{name:"warning sign"}),i.M.t("By deleting this record you acknowledge that:"),a.createElement("br",null),a.createElement(R.A,{label:a.createElement("label",null,a.createElement("strong",null,P," file",1!==P?"s":"")," ",i.M.t("will be deleted.")),className:"mt-5 mb-5",onChange:function(){return e.handleCheckboxUpdate(0)}}),a.createElement("br",null),j?a.createElement(R.A,{label:a.createElement("label",null,a.createElement("strong",null,i.M.t("The DOI cannot be reused"))," ",i.M.t("and the DOI will resolve to a tombstone page with the record's citation (including title, author/s, publication year and publisher)")),className:"mb-5",onChange:function(){return e.handleCheckboxUpdate(1)}}):a.createElement(R.A,{label:a.createElement("label",null,i.M.t("A tombstone page with the citation will replace the record page")),className:"mb-5",onChange:function(){return e.handleCheckboxUpdate(1)}}))),f.length>0&&a.createElement(a.Fragment,null,a.createElement("strong",null,i.M.t("Record deletion checklist:")),a.createElement(S.A,{basic:"very",unstackable:!0,className:"mt-0"},a.createElement(q.A,null,a.createElement(O.A,null,a.createElement(_.A,null),a.createElement(_.A,null,i.M.t("Yes")),a.createElement(_.A,null,i.M.t("No")))),a.createElement(D.A,null,f.map(function(t,n){return a.createElement(I,{index:n,row:t,key:t.name,state:d,onStateChange:e.handleRadioUpdate})}))),m.length>0&&a.createElement(M.A,{info:!0},1===m.length?a.createElement("p",{dangerouslySetInnerHTML:{__html:m[0]}}):a.createElement(M.A.List,null,m.map(function(e){return a.createElement(M.A.Item,{key:e},a.createElement("p",{dangerouslySetInnerHTML:{__html:e}}))})))),a.createElement(b.SelectField,{fluid:!0,fieldPath:"reason",name:"reason",label:i.M.t("I want to delete this record because:"),options:o,required:!0,disabled:T}),!h&&a.createElement(b.TextAreaField,{fieldPath:"comment",name:"comment",label:i.M.t("Detailed justification:"),required:!0,placeholder:i.M.t("Your justification will not be shared publicly"),disabled:T}),u&&a.createElement(b.ErrorMessage,{header:i.M.t("Unable to request deletion."),content:i.M.t(u),icon:"exclamation",className:"text-align-left",negative:!0})),a.createElement(N.A,null,a.createElement(l.A,{onClick:e.handleClose,content:i.M.t("Close"),floated:"left"}),a.createElement(l.A,{content:A,className:g,icon:"trash alternate outline",type:"submit",onClick:function(e){return n(e)},loading:c,disabled:T||c})))}))}}])}(a.Component);z.propTypes={record:c().object.isRequired,open:c().bool.isRequired,handleClose:c().func.isRequired,recordDeletion:c().object.isRequired,options:c().array.isRequired};var Y=function(e){var t=e.disabled,n=e.record,s=e.permissions,c=e.recordDeletion,u=e.options,d=(0,a.useState)(!1),p=(0,r.A)(d,2),m=p[0],f=p[1];return a.createElement(a.Fragment,null,a.createElement(o.A,{content:i.M.t("It is not possible to delete this record."),disabled:!t,trigger:a.createElement("span",null,c.existing_request?a.createElement(l.A,{fluid:!0,as:"a",href:c.existing_request,disabled:t,className:"basic",color:"red","aria-haspopup":"dialog",icon:"external alternate",labelPosition:"left",content:i.M.t("View deletion request")}):a.createElement(l.A,{fluid:!0,onClick:function(){return f(!0)},disabled:t,className:"negative","aria-haspopup":"dialog",icon:"trash outline alternate",labelPosition:"left",content:i.M.t("Delete record")}))}),a.createElement(z,{record:n,open:m,handleClose:function(){return f(!1)},permissions:s,recordDeletion:c,options:u}))};Y.propTypes={disabled:c().bool,record:c().object.isRequired,permissions:c().object.isRequired,recordDeletion:c().object.isRequired,options:c().array.isRequired},Y.defaultProps={disabled:!1}},69521:(e,t,n)=>{n.d(t,{rt:()=>o.r,Lr:()=>a.L,BK:()=>r.B});var r=n(88860),a=n(21252),o=n(60996)}}]);
//# sourceMappingURL=5097.9dd3ff342f98a300e468.js.map