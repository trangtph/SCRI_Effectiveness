"use strict";(self.webpackChunkinvenio_assets=self.webpackChunkinvenio_assets||[]).push([[5115],{53952:(e,t,n)=>{n.d(t,{J:()=>c});var r=n(64467),o=n(58156),a=n.n(o);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var c=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,r.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},{restore:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return"/api/users/".concat(a()(e,t),"/restore")},block:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return"/api/users/".concat(a()(e,t),"/block")},approve:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return"/api/users/".concat(a()(e,t),"/approve")},activate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return"/api/users/".concat(a()(e,t),"/activate")},deactivate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return"/api/users/".concat(a()(e,t),"/deactivate")},impersonate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return"/api/users/".concat(a()(e,t),"/impersonate")}})},62513:(e,t,n)=>{n.d(t,{i:()=>C});var r=n(10467),o=n(23029),a=n(92901),i=n(56822),c=n(53954),l=n(85501),s=n(64467),u=n(54756),m=n.n(u),d=n(96540),p=n(5556),f=n.n(p),h=n(93682),v=n(3487),g=n(94157);function A(e,t,n){return t=(0,c.A)(t),(0,i.A)(e,b()?Reflect.construct(t,n||[],(0,c.A)(e).constructor):t.apply(e,n))}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(b=function(){return!!e})()}var y=function(e){function t(){var e;(0,o.A)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return e=A(this,t,[].concat(a)),(0,s.A)(e,"fetchUrl",function(){var e=(0,r.A)(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,fetch(t);case 1:return e.next=2,e.sent.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),(0,s.A)(e,"handleClick",(0,r.A)(m().mark(function t(){var n,r,o,a,i;return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props,r=n.url,o=n.text,a=n.onCopy,i=o,!r){t.next=2;break}return t.next=1,e.fetchUrl(r);case 1:i=t.sent;case 2:return t.next=3,navigator.clipboard.writeText(i);case 3:a(o);case 4:case"end":return t.stop()}},t)}))),e}return(0,l.A)(t,e),(0,a.A)(t,[{key:"render",value:function(){var e=this.props,t=e.hoverState,n=e.size;return d.createElement(v.A,{className:"copy",basic:!0,size:n,icon:"copy","aria-label":g.M.t("Copy to clipboard"),onClick:this.handleClick,onMouseEnter:t,onMouseLeave:t})}}])}(d.Component);y.propTypes={text:f().string.isRequired,onCopy:f().func.isRequired,url:f().func,hoverState:f().func,size:f().string},y.defaultProps={hoverState:null,url:null,size:"medium"};var C=function(e){function t(e){var n;return(0,o.A)(this,t),n=A(this,t,[e]),(0,s.A)(n,"onCopy",function(){n.setState(function(){return{confirmationPopupIsOpen:!0,confirmationPopupMsg:g.M.t("Copied!")}}),n.delayClosePopup()}),(0,s.A)(n,"delayClosePopup",function(){var e=setTimeout(function(){n.setState(n.INITIAL_STATE)},1500);n.setState({stateReset:e})}),(0,s.A)(n,"hoverStateHandler",function(e){e.persist(),"mouseenter"===e.type&&n.setState({hoverPopupIsOpen:!0}),"mouseleave"===e.type&&n.setState({hoverPopupIsOpen:!1})}),n.INITIAL_STATE={confirmationPopupIsOpen:!1,confirmationPopupMsg:"",hoverPopupIsOpen:!1,stateReset:null},n.state=n.INITIAL_STATE,n}return(0,l.A)(t,e),(0,a.A)(t,[{key:"componentWillUnmount",value:function(){var e=this.state.stateReset;e&&clearTimeout(e)}},{key:"render",value:function(){var e=this.props,t=e.popUpPosition,n=e.text,r=e.url,o=e.size,a=this.state,i=a.confirmationPopupMsg,c=a.confirmationPopupIsOpen,l=a.hoverPopupIsOpen;return(n||r)&&d.createElement(h.A,{role:"alert",open:l||c,content:i||g.M.t("Copy to clipboard"),inverted:!!i,position:t,size:"mini",trigger:d.createElement(y,{text:n,onCopy:this.onCopy,url:r,hoverState:this.hoverStateHandler,size:o})})}}])}(d.Component);C.propTypes={popUpPosition:f().string,text:f().string,url:f().func,size:f().string},C.defaultProps={popUpPosition:"right center",text:"",url:"",size:"medium"}},80983:(e,t,n)=>{var r=n(96540),o=n(40961),a=n(23029),i=n(92901),c=n(56822),l=n(53954),s=n(85501),u=n(94157),m=n(1489),d=n(3487),p=n(76217),f=n(87395),h=n(10467),v=n(80296),g=n(54756),A=n.n(g),b=n(81057),y=n(5556),C=n.n(y),E=function(e){var t=e.recid,n=e.onError,o=(0,r.useState)(!1),a=(0,v.A)(o,2),i=a[0],c=a[1],l=function(){var e=(0,h.A)(A().mark(function e(){var r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),e.prev=1,e.next=2,b.http.post("/api/records/".concat(t,"/draft"),{},{headers:{"Content-Type":"application/json",Accept:"application/vnd.inveniordm.v1+json"}});case 2:window.location="/uploads/".concat(t),e.next=4;break;case 3:e.prev=3,r=e.catch(1),c(!1),n(r.response.data.message);case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}();return r.createElement(d.A,{fluid:!0,className:"warning",size:"medium",onClick:l,loading:i,icon:!0,labelPosition:"left"},r.createElement(p.A,{name:"edit"}),u.M.t("Edit"))};E.propTypes={recid:C().string.isRequired,onError:C().func.isRequired};var R=n(9300),M=n(37114),O=n(53196),k=n(34667),S=n(48423),w=n(53952),x=n(58616),q=function(){var e=(0,h.A)(A().mark(function e(){var t,n,r,o,a;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.http.get("/api/vocabularies/removalreasons?q=tags:deletion-request"),e.prev=1,e.next=2,t;case 2:return n=e.sent,r=n.data.hits.hits,o=r.map(function(e){return{text:e.title_l10n,value:e.id}}),e.abrupt("return",o);case 3:e.prev=3,a=e.catch(1),console.error(a);case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),N=function(e){var t=e.record,n=e.recordOwnerID,o=e.permissions,a=e.recordDeletion,i=(0,r.useState)([]),c=(0,v.A)(i,2),l=c[0],s=c[1];return(0,r.useEffect)(function(){q().then(s)},[]),r.createElement(k.A,{fluid:!0,text:u.M.t("Manage"),icon:"cog",floating:!0,labeled:!0,button:!0,className:"icon text-align-center"},r.createElement(k.A.Menu,null,a.valid_user&&r.createElement(r.Fragment,null,r.createElement(k.A.Item,null,r.createElement(x.c,{record:t,permissions:o,recordDeletion:a,options:l,disabled:!a.allowed})),o.can_moderate&&r.createElement(k.A.Divider,null)),o.can_moderate&&r.createElement(r.Fragment,null,r.createElement(k.A.Item,{as:"a",href:"/administration/records?q=id:".concat(t.id),target:"_blank",key:"manage_record",text:u.M.t("Manage record")}),r.createElement(k.A.Item,{as:"a",href:"/administration/users?q=id:".concat(n),target:"_blank",key:"manage_user",text:u.M.t("Manage user")}),r.createElement(k.A.Divider,null),n&&r.createElement(P,{recordOwnerID:n}))))};N.propTypes={record:C().object.isRequired,recordOwnerID:C().string.isRequired,permissions:C().object.isRequired,recordDeletion:C().object.isRequired};var P=function(e){var t=e.recordOwnerID,n=r.useState(!1),o=(0,v.A)(n,2),a=o[0],i=o[1],c=function(){return i(!1)};return r.createElement(r.Fragment,null,r.createElement(k.A.Item,{as:"a",className:"error",onClick:function(){return i(!0)},key:"block_user",text:u.M.t("Block user")}),r.createElement(S.A,{open:a,closeIcon:!0,onClose:c,role:"dialog",closeOnDimmerClick:!1},r.createElement(S.A.Header,{as:"h2"},u.M.t("Block User")),r.createElement(S.A.Description,null,r.createElement(f.A,{warning:!0,icon:"warning sign",content:u.M.t("Blocking the user will delete all existing records of the user.")})),r.createElement(S.A.Actions,null,r.createElement(d.A,{onClick:function(){return c()},floated:"left"},"Cancel"),r.createElement(d.A,{size:"small",labelPosition:"left",icon:"warning",color:"red",content:u.M.t("Block"),onClick:function(){b.http.post(w.J.block({id:t})),c()}}))))};function D(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(D=function(){return!!e})()}P.propTypes={recordOwnerID:C().string.isRequired};var j=function(e){function t(e){var n,r,o,i;return(0,a.A)(this,t),r=this,o=t,i=[e],o=(0,l.A)(o),(n=(0,c.A)(r,D()?Reflect.construct(o,i||[],(0,l.A)(r).constructor):o.apply(r,i))).state={error:""},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.record,o=t.permissions,a=t.isDraft,i=t.isPreviewSubmissionRequest,c=t.currentUserId,l=t.recordOwnerID,s=t.groupsEnabled,h=t.recordDeletion,v=this.state.error,g=n.id,A=function(t){console.error(t),e.setState({error:t})};return r.createElement(m.A,{columns:1,className:"record-management"},(h.valid_user||o.can_moderate)&&r.createElement(m.A.Column,{className:"pb-5"},r.createElement(N,{record:n,recordOwnerID:l,permissions:o,recordDeletion:h})),o.can_edit&&!a&&r.createElement(m.A.Column,{className:o.can_manage?"pb-5 pt-5":"pb-5"},r.createElement(E,{recid:g,onError:A})),i&&a&&r.createElement(m.A.Column,{className:"pb-20"},r.createElement(d.A,{fluid:!0,className:"warning",size:"medium",onClick:function(){return window.location="/uploads/".concat(g)},icon:!0,labelPosition:"left"},r.createElement(p.A,{name:"edit"}),u.M.t("Edit"))),!i&&r.createElement(r.Fragment,null,r.createElement(m.A.Column,{className:"pt-5 pb-5"},r.createElement(M.z4,{fluid:!0,size:"medium",record:n,onError:A,disabled:!o.can_new_version})),r.createElement(m.A.Column,{className:"pt-5"},o.can_manage&&r.createElement(R.w,{disabled:!o.can_update_draft,record:n,permissions:o,groupsEnabled:s}))),r.createElement(O.default,{id:"InvenioAppRdm.RecordLandingPage.RecordManagement.container",isPreviewSubmissionRequest:i,record:n,currentUserId:c,permissions:o}),v&&r.createElement(m.A.Row,{className:"record-management"},r.createElement(m.A.Column,null,r.createElement(f.A,{negative:!0},v))))}}])}(r.Component);j.propTypes={record:C().object.isRequired,permissions:C().object.isRequired,isDraft:C().bool.isRequired,groupsEnabled:C().bool.isRequired,isPreviewSubmissionRequest:C().bool.isRequired,currentUserId:C().string.isRequired,recordOwnerID:C().string.isRequired,recordDeletion:C().object.isRequired};var I=n(58168),T=n(58156),_=n.n(T),B=n(27859),U=n(24941),z=n(36713),L=function(e){return{id:e.id,parent:e.parent,parent_id:e.parent.id,publication_date:e.ui.publication_date_l10n_medium,version:e.ui.version,links:e.links,pids:e.pids,new_draft_parent_doi:e.ui.new_draft_parent_doi}},F=function(e){var t=e.item,n=e.activeVersion,o=_()(t.pids,"doi.identifier","");return r.createElement(B.A.Item,(0,I.A)({key:t.id},n&&{className:"version active"}),r.createElement(B.A.Content,{floated:"left"},n?r.createElement("span",{className:"text-break"},u.M.t("Version {{- version}}",{version:t.version})):r.createElement("a",{href:"/records/".concat(t.id),className:"text-break"},u.M.t("Version {{- version}}",{version:t.version})),o&&r.createElement("a",{href:"https://doi.org/".concat(o),className:"doi"+(n?" text-muted-darken":" text-muted")},o)),r.createElement(B.A.Content,{floated:"right"},r.createElement("small",{className:n?"text-muted-darken":"text-muted"},t.publication_date)))};F.propTypes={item:C().object.isRequired,activeVersion:C().bool.isRequired};var J=function(){return r.createElement(f.A,{info:!0,className:"no-border-radius m-0"},r.createElement(f.A.Header,null,r.createElement(p.A,{name:"eye"}),u.M.t("Preview")),r.createElement("p",null,u.M.t("Only published versions are displayed.")))},H=function(e){var t,n=e.record,o=e.isPreview,a=L(n),i=null===a||void 0===a||null===(t=a.parent)||void 0===t||null===(t=t.pids)||void 0===t||null===(t=t.doi)||void 0===t?void 0:t.identifier,c=null===a||void 0===a?void 0:a.new_draft_parent_doi,l=a.id,s=(0,r.useState)(!0),d=(0,v.A)(s,2),p=d[0],f=d[1],g=(0,r.useState)(null),y=(0,v.A)(g,2),C=y[0],E=y[1],R=(0,r.useState)(!1),M=(0,v.A)(R,2),O=M[0],k=M[1],S=(0,r.useState)({}),w=(0,v.A)(S,2),x=w[0],q=w[1];(0,r.useEffect)(function(){var e=function(){var e=(0,h.A)(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,b.http.get("".concat(a.links.versions,"?size=").concat(5,"&sort=version&allversions=true"),{headers:{Accept:"application/vnd.inveniordm.v1+json"},withCredentials:!0});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),t=(0,b.withCancel)(e());function n(){return n=(0,h.A)(A().mark(function e(){var n,r,o,a;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,t.promise;case 1:n=e.sent,r=n.data.hits,o=r.hits,a=r.total,o=o.map(L),k(o.some(function(e){return e.id===l})),q({hits:o,total:a}),f(!1),e.next=3;break;case 2:e.prev=2,"UNMOUNTED"!==e.catch(0)&&(E(u.M.t("An error occurred while fetching the versions.")),f(!1));case 3:case"end":return e.stop()}},e,null,[[0,2]])})),n.apply(this,arguments)}return function(){n.apply(this,arguments)}(),function(){null===t||void 0===t||t.cancel()}},[a.links.versions,l]);return p?o?r.createElement(J,null):r.createElement(r.Fragment,null,r.createElement("div",{className:"rel-p-1"}),r.createElement(U.A,{className:"rel-ml-1 rel-mr-1"},r.createElement(U.A.Header,null,r.createElement(U.A.Line,null),r.createElement(U.A.Line,null),r.createElement(U.A.Line,null)))):C?r.createElement(b.ErrorMessage,{className:"rel-mr-1 rel-ml-1",content:u.M.t(C),negative:!0}):r.createElement(B.A,{divided:!0},o?r.createElement(J,null):null,x.hits.map(function(e){return r.createElement(F,{key:e.id,item:e,activeVersion:e.id===l})}),!O&&r.createElement(r.Fragment,null,r.createElement(z.A,{horizontal:!0},"..."),r.createElement(F,{item:a,activeVersion:!0})),x.total>1&&r.createElement(m.A,{className:"mt-0"},r.createElement(m.A.Row,{centered:!0},r.createElement("a",{href:"/search?q=parent.id:".concat(a.parent_id,"&sort=version&f=allversions:true"),className:"font-small"},u.M.t("View all {{count}} versions",{count:x.total})))),i?r.createElement(B.A.Item,{className:"parent-doi pr-0"},r.createElement(B.A.Content,{floated:"left"},r.createElement("p",{className:"text-muted"},r.createElement("strong",null,u.M.t("Cite all versions?"))," ",u.M.t("You can cite all versions by using the DOI")," ",r.createElement("a",{href:a.links.parent_doi},i),"."," ",u.M.t("This DOI represents all versions, and will always resolve to the latest one.")," ",r.createElement("a",{href:"/help/versioning"},u.M.t("Read more")),"."))):c?r.createElement(B.A.Item,{className:"parent-doi pr-0"},r.createElement(B.A.Content,{floated:"left"},r.createElement("p",{className:"text-muted"},r.createElement("strong",null,u.M.t("Cite all versions?"))," ",u.M.t("You can cite all versions by using the DOI")," ",c,"."," ",u.M.t("The DOI is registered when the first version is published.")," ",r.createElement("a",{href:"/help/versioning"},u.M.t("Read more")),"."))):null)};H.propTypes={record:C().object.isRequired,isPreview:C().bool.isRequired};var V=n(64467),W=n(38221),K=n.n(W),G=n(14425),Q=n.n(G),Y=n(62513);function Z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Z=function(){return!!e})()}var $=function(e){function t(e){var n,o,i,s;return(0,a.A)(this,t),o=this,i=t,s=[e],i=(0,l.A)(i),n=(0,c.A)(o,Z()?Reflect.construct(i,s||[],(0,l.A)(o).constructor):i.apply(o,s)),(0,V.A)(n,"placeholderLoader",function(){return r.createElement(U.A,null,r.createElement(U.A.Paragraph,null,r.createElement(U.A.Line,null),r.createElement(U.A.Line,null),r.createElement(U.A.Line,null)))}),(0,V.A)(n,"errorMessage",function(e){return r.createElement(f.A,{negative:!0},e)}),(0,V.A)(n,"fetchCitation",function(){var e=(0,h.A)(A().mark(function e(t,n,r){var o,a;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=!0===r?"&include_deleted=1":"",a="".concat(t.self,"?locale=").concat(navigator.language,"&style=").concat(n).concat(o),e.next=1,b.http.get(a,{headers:{Accept:"text/x-bibliography"}});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),(0,V.A)(n,"getCitation",function(){var e=(0,h.A)(A().mark(function e(t,r,o){var a;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0,citation:"",error:""}),n.cancellableFetchCitation=(0,b.withCancel)(n.fetchCitation(t,r,o)),e.prev=1,e.next=2,n.cancellableFetchCitation.promise;case 2:a=e.sent,n.setState({loading:!1,citation:a.data}),e.next=4;break;case 3:e.prev=3,"UNMOUNTED"!==e.catch(1)&&n.setState({loading:!1,citation:"",error:u.M.t("An error occurred while generating the citation.")});case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t,n,r){return e.apply(this,arguments)}}()),n.state={loading:!0,citation:"",error:null},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.recordLinks,n=e.defaultStyle,r=e.includeDeleted;this.getCitation(t,n,r)}},{key:"componentDidUpdate",value:function(){var e=(0,h.A)(A().mark(function e(){var t;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,null===(t=window.MathJax)||void 0===t?void 0:t.typesetPromise();case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e;null===(e=this.cancellableFetchCitation)||void 0===e||e.cancel()}},{key:"render",value:function(){var e=this,t=this.props,n=t.styles,o=t.recordLinks,a=t.defaultStyle,i=t.includeDeleted,c=this.state,l=c.loading,s=c.citation,m=c.error,d=n.map(function(e){return{key:e[0],value:e[0],text:e[1]}}),p=Q()(s).replace(/(https?:\/\/[^\s,;]+(?=[^\s,;]*))/g,function(e){var t="";return e.endsWith(".")&&(t=".",e=e.slice(0,-1)),'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>").concat(t)});return r.createElement("div",null,r.createElement("div",{id:"citation-text",className:"wrap-overflowing-text rel-mb-2"},l?this.placeholderLoader():r.createElement("div",{dangerouslySetInnerHTML:{__html:p}})),r.createElement("div",{className:"auto-column-grid no-wrap"},r.createElement("div",{className:"flex align-items-center"},r.createElement("label",{id:"citation-style-label",className:"mr-10"},u.M.t("Style")),r.createElement(k.A,{className:"citation-dropdown","aria-labelledby":"citation-style-label",defaultValue:a,options:d,selection:!0,onChange:K()(function(t,n){return e.getCitation(o,n.value,i)},500)})),r.createElement(Y.i,{text:s})),m?this.errorMessage(m):null)}}])}(r.Component);function X(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(X=function(){return!!e})()}$.propTypes={styles:C().array.isRequired,recordLinks:C().object.isRequired,defaultStyle:C().string.isRequired,includeDeleted:C().bool.isRequired};var ee=function(e){function t(e){var n,r,o,i,s;(0,a.A)(this,t),o=this,i=t,s=[e],i=(0,l.A)(i);var u=(r=(0,c.A)(o,X()?Reflect.construct(i,s||[],(0,l.A)(o).constructor):i.apply(o,s))).props.formats;return r.state={selectedFormatUrl:null===(n=u[0])||void 0===n?void 0:n.export_url},r}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.props.formats,n=this.state.selectedFormatUrl,o=t.map(function(e,t){return{key:"option-".concat(t),text:e.name,value:e.export_url}});return r.createElement(m.A,null,r.createElement(m.A.Column,{width:10},r.createElement(k.A,{"aria-label":u.M.t("Export selection"),selection:!0,fluid:!0,selectOnNavigation:!1,options:o,onChange:function(t,n){return e.setState({selectedFormatUrl:n.value})},defaultValue:n})),r.createElement(m.A.Column,{width:4,className:"pl-0"},r.createElement(d.A,{as:"a",role:"button",fluid:!0,href:n,title:u.M.t("Download file")},u.M.t("Export"))),r.createElement(m.A.Column,{width:2,className:"pl-0"},r.createElement(Y.i,{url:n})))}}])}(r.Component);ee.propTypes={formats:C().array.isRequired};var te=n(27041),ne=n(50363);function re(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(re=function(){return!!e})()}var oe=function(e){function t(e){var n,o,i,s;return(0,a.A)(this,t),o=this,i=t,s=[e],i=(0,l.A)(i),n=(0,c.A)(o,re()?Reflect.construct(i,s||[],(0,l.A)(o).constructor):i.apply(o,s)),(0,V.A)(n,"openConfirmModal",function(){return n.setState({modalOpen:!0})}),(0,V.A)(n,"closeConfirmModal",function(){return n.setState(n.INITIAL_STATE)}),(0,V.A)(n,"handleDelete",(0,h.A)(A().mark(function e(){var t,r,o,a,i,c,l;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props,r=t.result,o=t.recordCommunityEndpoint,a=t.successCallback,n.setState({loading:!0}),i={communities:[{id:r.id}]},e.prev=1,e.next=2,b.http.delete(o,{data:i});case 2:c=e.sent,a(c.data),n.closeConfirmModal(),e.next=4;break;case 3:e.prev=3,l=e.catch(1),n.setState({error:l,loading:!1});case 4:case"end":return e.stop()}},e,null,[[1,3]])}))),(0,V.A)(n,"handleCheckboxChange",function(e,t){var r=t.id,o=t.checked,a=n.state,i=a.checkboxRecords,c=a.checkboxMembers;"members-confirm"===r&&n.setState({checkboxMembers:o,buttonDisabled:!(o&&i)}),"records-confirm"===r&&n.setState({checkboxRecords:o,buttonDisabled:!(c&&o)})}),n.INITIAL_STATE={modalOpen:!1,loading:!1,error:void 0,checkboxMembers:!1,checkboxRecords:!1,buttonDisabled:!0},n.state=n.INITIAL_STATE,n.checkBoxRef=r.createRef(),n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentDidUpdate",value:function(){if(this.state.modalOpen&&this.checkBoxRef){var e,t=this.checkBoxRef.current.inputRef;null===t||void 0===t||null===(e=t.current)||void 0===e||e.focus()}}},{key:"render",value:function(){var e,t=this,n=this.state,o=n.modalOpen,a=n.loading,i=n.error,c=n.checkboxMembers,l=n.checkboxRecords,s=n.buttonDisabled,m=this.props.result.metadata.title;return r.createElement(r.Fragment,null,r.createElement(d.A,{size:"tiny",negative:!0,labelPosition:"left",icon:"trash",floated:"right",onClick:this.openConfirmModal,content:u.M.t("Remove"),"aria-label":u.M.t("Remove {{communityTitle}} from this record",{communityTitle:m})}),r.createElement(S.A,{size:"tiny",dimmer:"blurring",open:o},r.createElement(S.A.Header,{as:"h2"},u.M.t("Remove community")),r.createElement(S.A.Content,null,r.createElement("p",null,u.M.t("Are you sure you want to remove the record from the community?")),r.createElement(f.A,{negative:!0},r.createElement(f.A.Header,{className:"rel-mb-1"},r.createElement(p.A,{name:"warning sign",className:"rel-mr-1"}),u.M.t("I understand the consequences:")),r.createElement(r.Fragment,null,r.createElement(ne.A,{ref:this.checkBoxRef,id:"members-confirm",label:r.createElement("label",null,u.M.t("Members of the community "),r.createElement("b",null,'"',m,'"'),u.M.t(" will "),r.createElement("u",null,u.M.t("lose their access")),u.M.t(" to the record.")),checked:c,onChange:this.handleCheckboxChange,className:"mb-5"}),r.createElement(ne.A,{id:"records-confirm",label:u.M.t("The record can only be re-included in the community by going through a new review by the community curators."),checked:l,onChange:this.handleCheckboxChange,className:"mb-5"})))),r.createElement(S.A.Actions,null,i&&r.createElement(b.ErrorMessage,{header:u.M.t("Something went wrong"),content:(null===(e=i.response)||void 0===e||null===(e=e.data)||void 0===e||null===(e=e.errors)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.message)||i.message,icon:"exclamation",className:"text-align-left",negative:!0}),r.createElement(d.A,{onClick:function(){return t.closeConfirmModal()},floated:"left",disabled:a,loading:a,"aria-label":u.M.t("Cancel removal")},u.M.t("Cancel")),r.createElement(d.A,{disabled:s||a,negative:!0,onClick:function(){return t.handleDelete()},loading:a,content:u.M.t("Remove"),"aria-label":u.M.t("Confirm removal")}))))}}])}(r.Component);oe.propTypes={result:C().object.isRequired,recordCommunityEndpoint:C().object.isRequired,successCallback:C().func.isRequired};var ae=n(78585),ie=n(93682);function ce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ce=function(){return!!e})()}var le=function(e){function t(e){var n,o,i,s;return(0,a.A)(this,t),o=this,i=t,s=[e],i=(0,l.A)(i),n=(0,c.A)(o,ce()?Reflect.construct(i,s||[],(0,l.A)(o).constructor):i.apply(o,s)),(0,V.A)(n,"handleSetBranding",function(){var e=(0,h.A)(A().mark(function e(t){var r,o,a,i,c,l,s;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props,o=r.recordCommunityEndpoint,a=r.updateRecordCallback,n.setState({loading:!0}),i={default:t},n.cancellableAction=(0,b.withCancel)(b.http.put(o,i)),e.prev=1,e.next=2,n.cancellableAction.promise;case 2:c=e.sent,n.setState({loading:!1}),a(c.data),e.next=5;break;case 3:if(e.prev=3,"UNMOUNTED"!==(s=e.catch(1))){e.next=4;break}return e.abrupt("return");case 4:console.error(s),n.setState({error:(null===s||void 0===s||null===(l=s.response)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.message)||(null===s||void 0===s?void 0:s.message),loading:!1});case 5:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}()),(0,V.A)(n,"renderCommunity",function(){var e=n.state.loading,t=n.props,o=t.result,a=t.isCommunityDefault,i=o.metadata.title;return a?r.createElement(ie.A,{trigger:r.createElement(d.A,{size:"tiny",labelPosition:"left",icon:"paint brush",floated:"right",onClick:function(){return n.handleSetBranding(null)},content:u.M.t("Remove branding"),"aria-label":u.M.t("{{communityTitle}} is a default branding for this record",{communityTitle:i}),loading:e}),content:u.M.t("Remove this community from appearing on top of the record details page."),position:"top center"}):r.createElement(ie.A,{trigger:r.createElement(d.A,{size:"tiny",labelPosition:"left",icon:"paint brush",floated:"right",onClick:function(){return n.handleSetBranding(o.id)},content:u.M.t("Set branding"),"aria-label":u.M.t("Set {{communityTitle}} as a default branding for this record",{communityTitle:i}),loading:e}),content:u.M.t("Set this community to appear on the top of the record details page."),position:"top center"})}),n.state={loading:!1,error:void 0},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this.state.error;return e?r.createElement(f.A,{negative:!0,floated:"right",className:"community-branding-error",size:"tiny"},e):this.renderCommunity()}}])}(r.Component);function se(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(se=function(){return!!e})()}le.propTypes={result:C().object.isRequired,recordCommunityEndpoint:C().object.isRequired,updateRecordCallback:C().func.isRequired,isCommunityDefault:C().bool.isRequired};var ue=function(e){function t(){return(0,a.A)(this,t),e=this,n=t,r=arguments,n=(0,l.A)(n),(0,c.A)(e,se()?Reflect.construct(n,r||[],(0,l.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e,t=this.props,n=t.result,o=t.successCallback,a=t.updateRecordCallback,i=t.recordCommunityEndpoint,c=t.recordParent,l=t.permissions.can_manage,s=(null===c||void 0===c||null===(e=c.communities)||void 0===e?void 0:e.default)===(null===n||void 0===n?void 0:n.id),u=l&&r.createElement(r.Fragment,null,r.createElement(le,{result:n,recordCommunityEndpoint:i,updateRecordCallback:a,isCommunityDefault:s}),r.createElement(oe,{result:n,recordCommunityEndpoint:i,successCallback:o}));return r.createElement(ae.mG,{actions:u,result:n,isCommunityDefault:s})}}])}(r.Component);ue.propTypes={result:C().object.isRequired,recordCommunityEndpoint:C().string.isRequired,successCallback:C().func.isRequired,updateRecordCallback:C().func.isRequired,permissions:C().object.isRequired,recordParent:C().object.isRequired};var me=n(98871);function de(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(de=function(){return!!e})()}var pe="InvenioAppRdm.RecordCommunitiesSearch",fe=function(e){function t(){var e,n,r,o;(0,a.A)(this,t);for(var i=arguments.length,s=new Array(i),m=0;m<i;m++)s[m]=arguments[m];return n=this,r=t,o=[].concat(s),r=(0,l.A)(r),e=(0,c.A)(n,de()?Reflect.construct(r,o||[],(0,l.A)(n).constructor):r.apply(n,o)),(0,V.A)(e,"handleSuccessCallback",function(t){(0,e.props.successActionCallback)(t,u.M.t("Success"))}),e}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.recordCommunityEndpoint,n=e.permissions,o=e.recordParent,a=e.updateRecordCallback,i=(0,V.A)({},"".concat(pe,".ResultsList.item"),(0,O.parametrize)(ue,{recordCommunityEndpoint:t,successCallback:this.handleSuccessCallback,updateRecordCallback:a,permissions:n,recordParent:o})),c=new me.HZ({axios:{url:t,headers:{Accept:"application/vnd.inveniordm.v1+json"}}});return r.createElement(O.OverridableContext.Provider,{value:i},r.createElement(me.gz,{appName:pe,urlHandlerApi:{enabled:!1},searchApi:c,initialQueryState:{size:5,page:1}},r.createElement(r.Fragment,null,r.createElement(S.A.Content,null,r.createElement(me.IW,{autofocus:!0,actionProps:{icon:"search",content:null,className:"search","aria-label":u.M.t("Search")},placeholder:u.M.t("Search for community...")})),r.createElement(S.A.Content,{scrolling:!0,className:"community-list-results"},r.createElement(me.oK,null,r.createElement(me.i6,null),r.createElement(me.$D,null),r.createElement(me.dy,null))),r.createElement(S.A.Content,{className:"text-align-center"},r.createElement(me.dK,null)))))}}])}(r.Component);function he(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(he=function(){return!!e})()}fe.propTypes={recordCommunityEndpoint:C().string.isRequired,successActionCallback:C().func.isRequired,updateRecordCallback:C().func.isRequired,permissions:C().object.isRequired,recordParent:C().object.isRequired};var ve=function(e){function t(e){var n,r,o,i;(0,a.A)(this,t),r=this,o=t,i=[e],o=(0,l.A)(o),n=(0,c.A)(r,he()?Reflect.construct(o,i||[],(0,l.A)(r).constructor):o.apply(r,i)),(0,V.A)(n,"handleRecordUpdate",function(e){n.setState({recordParent:e})});var s=n.props.recordParent;return n.state={recordParent:s},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.recordCommunityEndpoint,n=e.modalOpen,o=e.successActionCallback,a=e.handleOnOpen,i=e.handleOnClose,c=e.trigger,l=e.permissions,s=this.state.recordParent;return r.createElement(S.A,{role:"dialog","aria-labelledby":"record-communities-header",id:"community-selection-modal",closeOnDimmerClick:!1,closeIcon:!0,open:n,onClose:i,onOpen:a,trigger:c},r.createElement(S.A.Header,null,r.createElement(te.A,{as:"h2",size:"small",id:"record-communities-header",className:"mt-5"},u.M.t("Communities"))),r.createElement(fe,{recordCommunityEndpoint:t,successActionCallback:o,permissions:l,recordParent:s,updateRecordCallback:this.handleRecordUpdate}),r.createElement(S.A.Actions,null,r.createElement(d.A,{onClick:i},u.M.t("Close"))))}}])}(r.Component);ve.propTypes={recordCommunityEndpoint:C().string.isRequired,trigger:C().object,modalOpen:C().bool,successActionCallback:C().func.isRequired,handleOnClose:C().func.isRequired,handleOnOpen:C().func.isRequired,permissions:C().object.isRequired,recordParent:C().object.isRequired},ve.defaultProps={modalOpen:!1,trigger:void 0};var ge=n(62193),Ae=n.n(ge),be=n(23848),ye=n(98866);function Ce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ce=function(){return!!e})()}var Ee=function(e){function t(){return(0,a.A)(this,t),e=this,n=t,r=arguments,n=(0,l.A)(n),(0,c.A)(e,Ce()?Reflect.construct(n,r||[],(0,l.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.communities,n=e.loading,o=e.error,a=e.maxDisplayedCommunities,i=null;if(n)i=r.createElement(U.A,null,r.createElement(U.A.Header,{image:!0},r.createElement(U.A.Line,null),r.createElement(U.A.Line,null)),r.createElement(U.A.Header,{image:!0},r.createElement(U.A.Line,null),r.createElement(U.A.Line,null)),r.createElement(U.A.Header,{image:!0},r.createElement(U.A.Line,null),r.createElement(U.A.Line,null)));else if(Ae()(t))i=r.createElement("p",null,r.createElement("i",null,r.createElement("small",null,u.M.t("This record is not included in any communities yet."))));else if((null===t||void 0===t?void 0:t.length)>0){var c=null===t||void 0===t?void 0:t.slice(0,a).map(function(e){var t;return r.createElement(m.A,{key:e.id},r.createElement(m.A.Row,{verticalAlign:"middle"},r.createElement(m.A.Column,{width:2},r.createElement(b.Image,{wrapped:!0,size:"mini",src:e.links.logo,alt:""})),r.createElement(m.A.Column,{width:14},r.createElement(be.A.Content,null,r.createElement(be.A.Header,{className:"ui"},r.createElement(te.A,{as:"a",href:e.links.self_html,size:"small"},e.metadata.title,((null===(t=e.children)||void 0===t?void 0:t.allow)||void 0!==e.parent)&&r.createElement("p",{className:"ml-5 display-inline-block"},r.createElement(ie.A,{content:"Verified community",trigger:r.createElement(p.A,{size:"small",color:"green",name:"check circle outline"}),position:"top center"}))),e.parent&&r.createElement(ye.A,null,u.M.t("Part of")," ",r.createElement("a",{href:"/communities/".concat(e.parent.slug)},u.M.t(e.parent.metadata.title))))))))});i=r.createElement(r.Fragment,null,r.createElement(be.A.Group,{unstackable:!0},c),o&&r.createElement(f.A,{error:!0},o))}return i}}])}(r.Component);Ee.propTypes={maxDisplayedCommunities:C().number.isRequired,communities:C().array,loading:C().bool,error:C().string},Ee.defaultProps={communities:void 0,loading:!1,error:""};var Re=n(2685),Me=n(27089),Oe=n(31827),ke=(n(4947),n(9504),n(42035),n(2115),n(91343));n(46842),n(13254),n(12261),n(51253),n(43977);function Se(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Se=function(){return!!e})()}var we=function(e){function t(){return(0,a.A)(this,t),e=this,n=t,r=arguments,n=(0,l.A)(n),(0,c.A)(e,Se()?Reflect.construct(n,r||[],(0,l.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.result,n=e.successCallback,o=t.expanded.receiver,a=t.links.self_html.replace("/requests","/me/requests"),i=r.createElement(ke.U,{request:t,actionSuccessCallback:n});return r.createElement(ae.mG,{result:o,actions:i,detailUrl:a})}}])}(r.Component);function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(qe=function(){return!!e})()}we.propTypes={result:C().object.isRequired,successCallback:C().func.isRequired};var Ne="InvenioAppRdm.PendingCommunitiesSearch",Pe=function(e){function t(){var e,n,r,o;(0,a.A)(this,t);for(var i=arguments.length,s=new Array(i),m=0;m<i;m++)s[m]=arguments[m];return n=this,r=t,o=[].concat(s),r=(0,l.A)(r),e=(0,c.A)(n,qe()?Reflect.construct(r,o||[],(0,l.A)(n).constructor):r.apply(n,o)),(0,V.A)(e,"handleSuccessCallback",function(t){(0,e.props.successActionCallback)(t,u.M.t("Success"))}),e}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props.searchConfig,t=new me.HZ(e.searchApi),n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach(function(t){(0,V.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}((0,V.A)({},"".concat(Ne,".ResultsList.item"),(0,O.parametrize)(we,{successCallback:this.handleSuccessCallback})),Oe.Lu);return r.createElement(O.OverridableContext.Provider,{value:n},r.createElement(me.gz,{appName:Ne,urlHandlerApi:{enabled:!1},searchApi:t,initialQueryState:e.initialQueryState},r.createElement(r.Fragment,null,r.createElement(S.A.Content,null,r.createElement(me.IW,{autofocus:!0,actionProps:{icon:"search",content:null,className:"search","aria-label":u.M.t("Search")},placeholder:u.M.t("Search for pending submissions to communities...")})),r.createElement(S.A.Content,{scrolling:!0,className:"community-list-results"},r.createElement(me.oK,null,r.createElement(me.i6,null),r.createElement(me.$D,null),r.createElement(me.dy,null))),r.createElement(S.A.Content,{className:"text-align-center"},r.createElement(me.dK,null)))))}}])}(r.Component);function De(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(De=function(){return!!e})()}Pe.propTypes={searchConfig:C().object.isRequired,successActionCallback:C().func.isRequired};var je=function(e){function t(){return(0,a.A)(this,t),e=this,n=t,r=arguments,n=(0,l.A)(n),(0,c.A)(e,De()?Reflect.construct(n,r||[],(0,l.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.searchConfig,n=e.modalOpen,o=e.successActionCallback,a=e.handleOnOpen,i=e.handleOnClose;return r.createElement(S.A,{role:"dialog","aria-labelledby":"record-communities-header",id:"community-selection-modal",closeIcon:!0,closeOnDimmerClick:!1,open:n,onClose:i,onOpen:a},r.createElement(S.A.Header,null,r.createElement(te.A,{as:"h2",size:"small",id:"record-communities-header",className:"mt-5"},u.M.t("Pending communities"))),r.createElement(Pe,{searchConfig:t,successActionCallback:o}),r.createElement(S.A.Actions,null,r.createElement(d.A,{onClick:i},u.M.t("Close"))))}}])}(r.Component);function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach(function(t){(0,V.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _e(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_e=function(){return!!e})()}je.propTypes={searchConfig:C().object.isRequired,modalOpen:C().bool,successActionCallback:C().func.isRequired,handleOnClose:C().func.isRequired,handleOnOpen:C().func.isRequired},je.defaultProps={modalOpen:!1};var Be=function(e){function t(e){var n,r,o,i;return(0,a.A)(this,t),r=this,o=t,i=[e],o=(0,l.A)(o),n=(0,c.A)(r,_e()?Reflect.construct(o,i||[],(0,l.A)(r).constructor):o.apply(r,i)),(0,V.A)(n,"changeSelectedCommunity",function(e){n.setState({selectedCommunity:e,error:null}),n.openConfirmModal()}),(0,V.A)(n,"canIncludeDirectly",function(){var e=n.state.selectedCommunity;return n.props.userCommunitiesMemberships[null===e||void 0===e?void 0:e.id]&&"open"===(null===e||void 0===e?void 0:e.access.review_policy)}),(0,V.A)(n,"isIncludedDirectly",function(e){return e.is_closed&&"accepted"===e.status}),(0,V.A)(n,"handleSuccessSubmit",function(e){var t=n.props.handleSuccessAction;n.closeConfirmModal(),n.isIncludedDirectly(e.processed[0].request)?t(e,u.M.t("Record submitted")):t(e,u.M.t("Review requested"))}),(0,V.A)(n,"submitCommunity",function(){var e=(0,h.A)(A().mark(function e(t){var r,o,a,i,c;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.recordCommunityEndpoint,o=n.state.selectedCommunity,n.setState({loading:!0,error:null}),e.prev=1,a={communities:[{id:o.id}]},t&&(a={communities:[{id:o.id,comment:{payload:{content:t,format:"html"}}}]}),e.next=2,b.http.post(r,a,{headers:{Accept:"application/json","Content-Type":"application/json"}});case 2:i=e.sent,n.handleSuccessSubmit(i.data),e.next=4;break;case 3:e.prev=3,c=e.catch(1),console.error(c),n.setState({error:c.message});case 4:return e.prev=4,n.setState({loading:!1}),e.finish(4);case 5:case"end":return e.stop()}},e,null,[[1,3,4,5]])}));return function(t){return e.apply(this,arguments)}}()),(0,V.A)(n,"openConfirmModal",function(){return n.setState({confirmationModalOpen:!0})}),(0,V.A)(n,"closeConfirmModal",function(){return n.setState({confirmationModalOpen:!1})}),n.state={confirmationModalOpen:!1,selectedCommunity:null,loading:!1,error:null},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.selectedCommunity,o=t.confirmationModalOpen,a=t.loading,i=t.error,c=this.props,l=c.userCommunitiesMemberships,s=c.modalOpen,m=c.toggleModal,d=c.recordUserCommunitySearchConfig,p=c.recordCommunitySearchConfig,h=c.handleClose,v=c.record,g={allCommunities:Te(Te({},p),{},{toggleText:u.M.t("Search in all communities")}),myCommunities:Te(Te({},d),{},{toggleText:u.M.t("Search in my communities")})};return r.createElement(r.Fragment,null,r.createElement(M.qE,{onCommunityChange:this.changeSelectedCommunity,chosenCommunity:n,modalOpen:s,userCommunitiesMemberships:l,onModalChange:m,modalHeader:u.M.t("Select a community"),apiConfigs:g,handleClose:h,record:v,isInitialSubmission:!1}),o&&r.createElement(M.Kd,{loading:a,errors:i&&r.createElement(f.A,{error:!0},i),isConfirmModalOpen:o,onSubmit:function(t){var n=t.reviewComment;return e.submitCommunity(n)},community:n,onClose:function(){return e.closeConfirmModal()},directPublish:this.canIncludeDirectly(),record:v}))}}])}(r.Component);Be.propTypes={modalOpen:C().bool,toggleModal:C().func.isRequired,userCommunitiesMemberships:C().object.isRequired,handleSuccessAction:C().func.isRequired,recordCommunityEndpoint:C().string.isRequired,recordCommunitySearchConfig:C().object.isRequired,recordUserCommunitySearchConfig:C().string.isRequired,handleClose:C().func.isRequired,record:C().object.isRequired},Be.defaultProps={modalOpen:!1};var Ue=n(69521);function ze(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ze=function(){return!!e})()}var Le=function(e){function t(e){var n,o,i,s;return(0,a.A)(this,t),o=this,i=t,s=[e],i=(0,l.A)(i),n=(0,c.A)(o,ze()?Reflect.construct(i,s||[],(0,l.A)(o).constructor):i.apply(o,s)),(0,V.A)(n,"focusDropdownRef",function(){n.dropdownRef.current.ref.current.focus()}),(0,V.A)(n,"handleSuccessAction",function(e,t){var r=n.props.actionSucceed;n.setState({actionFeedback:t,visibleSuccessAction:!1}),n.toggleSubmissionModal(!1),n.togglePendingRequestsModal(!1),n.setState({visibleSuccessAction:!0}),n.focusDropdownRef(),r()}),(0,V.A)(n,"toggleSubmissionModal",function(e){n.setState({submissionModalOpen:e}),e||n.focusDropdownRef()}),(0,V.A)(n,"togglePendingRequestsModal",function(e){n.setState({pendingRequestModalOpen:e}),e||n.focusDropdownRef()}),(0,V.A)(n,"handleChange",function(e,t){var r=n.props.toggleManageCommunitiesModal;switch(t.value){case"submit-to-community":n.toggleSubmissionModal(!0);break;case"pending-submissions":n.togglePendingRequestsModal(!0);break;case"manage-communities":r(!0);break;default:return}}),n.state={submissionModalOpen:!1,pendingRequestModalOpen:!1,visibleSuccessAction:!1,actionFeedback:""},n.dropdownRef=r.createRef(),n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.visibleSuccessAction,o=t.submissionModalOpen,a=t.actionFeedback,i=t.pendingRequestModalOpen,c=this.props,l=c.userCommunitiesMemberships,s=c.searchConfig,m=c.recordCommunitySearchConfig,d=c.recordCommunityEndpoint,f=c.recordUserCommunitySearchConfig,h=c.record,v=[{id:"submit-to-community",value:"submit-to-community",text:u.M.t("Submit to community"),icon:"plus"},{id:"pending-submissions",value:"pending-submissions",text:u.M.t("Pending submissions"),icon:"comments outline"},{id:"manage-communities",value:"manage-communities",text:u.M.t("Manage communities"),icon:"settings"}];return r.createElement(r.Fragment,null,r.createElement("div",{className:"flex align-items-baseline ml-auto rel-mr-1 green-color"},n&&r.createElement(Ue.BK,{timeOutDelay:5e3,show:n,content:r.createElement("div",{role:"alert",className:"half-width sub header small text size truncated"},a)})),!h.is_draft&&r.createElement(k.A,{ref:this.dropdownRef,id:"modal-dropdown",className:"manage-menu-dropdown","aria-label":u.M.t("Community management menu dropdown"),closeOnChange:!0,direction:"left",options:v,onChange:this.handleChange,selectOnBlur:!1,selectOnNavigation:!1,value:null,trigger:r.createElement(p.A,{name:"cog",color:"grey",className:"ml-0"})}),r.createElement(Be,{modalOpen:o,userCommunitiesMemberships:l,toggleModal:this.toggleSubmissionModal,handleClose:function(){return e.toggleSubmissionModal(!1)},handleSuccessAction:this.handleSuccessAction,recordCommunityEndpoint:d,recordCommunitySearchConfig:m,recordUserCommunitySearchConfig:f,record:h}),r.createElement(je,{modalOpen:i,handleOnOpen:function(){return e.togglePendingRequestsModal(!0)},handleOnClose:function(){return e.togglePendingRequestsModal(!1)},successActionCallback:this.handleSuccessAction,searchConfig:s}))}}])}(r.Component);function Fe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Fe=function(){return!!e})()}Le.propTypes={userCommunitiesMemberships:C().object.isRequired,recordCommunityEndpoint:C().string.isRequired,recordCommunitySearchConfig:C().string.isRequired,recordUserCommunitySearchConfig:C().string.isRequired,toggleManageCommunitiesModal:C().func.isRequired,actionSucceed:C().func,searchConfig:C().object.isRequired,record:C().object.isRequired},Le.defaultProps={actionSucceed:void 0};var Je=function(e){function t(e){var n,r,o,i;return(0,a.A)(this,t),r=this,o=t,i=[e],o=(0,l.A)(o),n=(0,c.A)(r,Fe()?Reflect.construct(o,i||[],(0,l.A)(r).constructor):o.apply(r,i)),(0,V.A)(n,"toggleManageCommunitiesModal",function(e){if(!e){var t=document.getElementById("modal-dropdown");t&&t.focus()}n.setState({manageCommunitiesModalOpen:e})}),(0,V.A)(n,"fetchRecordCommunities",(0,h.A)(A().mark(function e(){var t;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.recordCommunityEndpoint,e.next=1,b.http.get(t,{headers:{Accept:"application/vnd.inveniordm.v1+json"}});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}))),(0,V.A)(n,"getCommunities",(0,h.A)(A().mark(function e(){var t,r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.cancellableFetchCommunities=(0,b.withCancel)(n.fetchRecordCommunities()),n.setState({loading:!0,error:null}),e.prev=1,e.next=2,n.cancellableFetchCommunities.promise;case 2:t=e.sent,r=t.data.hits.hits,n.setState({communities:r,loading:!1}),e.next=4;break;case 3:e.prev=3,"UNMOUNTED"!==e.catch(1)&&n.setState({loading:!1,error:u.M.t("An error occurred while fetching communities.")});case 4:case"end":return e.stop()}},e,null,[[1,3]])}))),(0,V.A)(n,"handleRefresh",function(){n.getCommunities(),n.toggleManageCommunitiesModal(!1)}),n.state={loading:!0,communities:void 0,error:void 0,manageCommunitiesModalOpen:!1},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentDidMount",value:function(){this.getCommunities()}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.cancellableFetchCommunities)||void 0===e||e.cancel()}},{key:"render",value:function(){var e,t=this,n=this.props,o=n.recordCommunitySearchConfig,a=n.permissions,i=n.userCommunitiesMemberships,c=n.recordCommunityEndpoint,l=n.recordUserCommunitySearchConfig,s=n.searchConfig,m=n.record,p=this.state,f=p.communities,h=p.loading,v=p.error,g=p.manageCommunitiesModalOpen;return(!Ae()(f)||a.can_manage)&&r.createElement(r.Fragment,null,r.createElement(te.A,{size:"medium",as:"h2",className:"flex align-items-baseline mt-0",attached:"top"},u.M.t("Communities"),a.can_manage&&r.createElement(Le,{actionSucceed:this.handleRefresh,userCommunitiesMemberships:i,recordCommunityEndpoint:c,searchConfig:s,recordCommunitySearchConfig:o,recordUserCommunitySearchConfig:l,toggleManageCommunitiesModal:this.toggleManageCommunitiesModal,record:m})),r.createElement(Re.A,{attached:"bottom",className:"rdm-sidebar"},r.createElement(Ee,{permissions:a,communities:f,error:v,loading:h,maxDisplayedCommunities:3,branded:null===(e=m.parent)||void 0===e||null===(e=e.communities)||void 0===e?void 0:e.default}),r.createElement(ve,{id:"record-communities-list-modal",modalOpen:g,handleOnOpen:function(){return t.toggleManageCommunitiesModal(!0)},handleOnClose:function(){return t.toggleManageCommunitiesModal(!1)},successActionCallback:this.handleRefresh,recordCommunityEndpoint:c,permissions:a,recordParent:m.parent}),!h&&(null===f||void 0===f?void 0:f.length)>3&&r.createElement(Me.A,{align:"center",className:"mt-10"},r.createElement(d.A,{className:"transparent","aria-haspopup":"dialog","aria-expanded":g,"aria-controls":"record-communities-list-modal",onClick:function(){return t.toggleManageCommunitiesModal(!0)}},u.M.t("View all {{count}} communities",{count:f.length})))))}}])}(r.Component);Je.propTypes={recordCommunitySearchConfig:C().object.isRequired,recordCommunityEndpoint:C().string.isRequired,recordUserCommunitySearchConfig:C().object.isRequired,permissions:C().object.isRequired,userCommunitiesMemberships:C().object.isRequired,searchConfig:C().object.isRequired,record:C().object.isRequired};var He=O.overrideStore.getAll(),Ve=document.getElementById("recordManagement"),We=document.getElementById("recordManagementMobile");function Ke(e){var t=JSON.parse(Ve.dataset.record);o.render(r.createElement(O.OverridableContext.Provider,{value:He},r.createElement(j,{record:t,permissions:JSON.parse(Ve.dataset.permissions),isDraft:JSON.parse(Ve.dataset.isDraft),isPreviewSubmissionRequest:JSON.parse(Ve.dataset.isPreviewSubmissionRequest),currentUserId:Ve.dataset.currentUserId,recordOwnerID:t.parent.access.owned_by.user,groupsEnabled:JSON.parse(Ve.dataset.groupsEnabled),recordDeletion:JSON.parse(Ve.dataset.recordDeletion)})),e)}Ve&&(Ke(Ve),We&&Ke(We));var Ge=document.getElementById("recordVersions");Ge&&o.render(r.createElement(H,{record:JSON.parse(Ge.dataset.record),isPreview:JSON.parse(Ge.dataset.preview)}),Ge);var Qe=document.getElementById("recordCitation");Qe&&o.render(r.createElement($,{recordLinks:JSON.parse(Qe.dataset.recordLinks),styles:JSON.parse(Qe.dataset.styles),defaultStyle:JSON.parse(Qe.dataset.defaultstyle),includeDeleted:JSON.parse(Qe.dataset.includeDeleted)}),Qe);var Ye=document.getElementById("recordExportDownload");Ye&&o.render(r.createElement(ee,{formats:JSON.parse(Ye.dataset.formats)}),Ye);var Ze=document.getElementById("sidebar-communities-manage");if(Ze){var $e=JSON.parse(Ze.dataset.userCommunitiesMemberships),Xe=Ze.dataset.recordCommunityEndpoint,et=JSON.parse(Ze.dataset.recordCommunitySearchConfig),tt=JSON.parse(Ze.dataset.recordUserCommunitySearchConfig),nt=JSON.parse(Ze.dataset.pendingCommunitiesSearchConfig),rt=JSON.parse(Ze.dataset.permissions),ot=JSON.parse(Ze.dataset.record);o.render(r.createElement(O.OverridableContext.Provider,{value:He},r.createElement(O.default,{id:"InvenioAppRdm.RecordLandingPage.CommunitiesManagement.container",userCommunitiesMemberships:$e,recordCommunityEndpoint:Xe,recordUserCommunitySearchConfig:tt,recordCommunitySearchConfig:et,permissions:rt,searchConfig:nt,record:ot},r.createElement(Je,{userCommunitiesMemberships:$e,recordCommunityEndpoint:Xe,recordUserCommunitySearchConfig:tt,recordCommunitySearchConfig:et,permissions:rt,searchConfig:nt,record:ot}))),Ze)}}},e=>{e.O(0,[3378,1057,7655,5092,8871,278,5941,9736,4683,4848,6471,9025,2301,4157,7302,4252,8585,1357,5002,7114,1644,8962,5097,5680],()=>{return t=80983,e(e.s=t);var t});e.O()}]);
//# sourceMappingURL=invenio-app-rdm-landing-page.1373bf9e631bd1830e18.js.map